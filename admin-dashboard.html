<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Axxess Dealer Portal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { font-family: 'Poppins', sans-serif; }
        /* Axxess Blue with subtle Openserve Green */
        :root {
            --axxess-blue: #1e3a5f;
            --axxess-blue-dark: #0f2640;
            --axxess-blue-light: #2d4a6f;
            --openserve-green: #10b981;
            --openserve-green-light: #34d399;
            --accent-50: #eff6ff;
            --accent-100: #dbeafe;
            --accent-500: #3b82f6;
            --accent-600: #2563eb;
            --accent-700: #1d4ed8;
        }
        .sidebar-bg { 
            background: linear-gradient(180deg, var(--axxess-blue-dark) 0%, var(--axxess-blue) 100%);
        }
        .main-bg { background: #f1f5f9; }
        .card { 
            background: white; 
            border-radius: 0.75rem; 
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
            border: 1px solid #e2e8f0;
        }
        .btn-primary { 
            background: linear-gradient(135deg, var(--axxess-blue) 0%, var(--axxess-blue-dark) 100%);
            transition: all 0.2s ease;
        }
        .btn-primary:hover { 
            transform: translateY(-1px); 
            box-shadow: 0 4px 14px rgba(30, 58, 95, 0.4);
            background: linear-gradient(135deg, var(--axxess-blue-light) 0%, var(--axxess-blue) 100%);
        }
        .btn-success {
            background: linear-gradient(135deg, var(--openserve-green) 0%, #059669 100%);
        }
        .status-new { background: #dbeafe; color: #1e40af; }
        .status-lead { background: #fef3c7; color: #92400e; }
        .status-pending { background: #fef3c7; color: #92400e; }
        .status-contacted { background: #e0e7ff; color: #3730a3; }
        .status-qualified { background: #d1fae5; color: #065f46; }
        .status-processing { background: #dbeafe; color: #1e40af; }
        .status-scheduled { background: #e0e7ff; color: #3730a3; }
        .status-completed { background: #d1fae5; color: #065f46; }
        .status-converted { background: #bbf7d0; color: #166534; }
        .status-cancelled { background: #fee2e2; color: #991b1b; }
        .status-returned { background: #fce7f3; color: #9d174d; }
        .status-lost { background: #f3f4f6; color: #4b5563; }
        .nav-item { transition: all 0.2s ease; border-radius: 0.5rem; }
        .nav-item:hover { background: rgba(255,255,255,0.1); }
        .nav-item.active { background: rgba(16, 185, 129, 0.2); border-left: 3px solid var(--openserve-green); }
        .table-row:hover { background: #f8fafc; }
        .modal { display: none; }
        .modal.active { display: flex; }
        /* Refined card hover */
        .card:hover { box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
        /* Accent border */
        .accent-border { border-left: 4px solid var(--primary-500); }
        
        /* Mobile Responsive */
        @media (max-width: 768px) {
            .sidebar { transform: translateX(-100%); transition: transform 0.3s ease; }
            .sidebar.open { transform: translateX(0); }
            .sidebar-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 40; }
            .sidebar-overlay.active { display: block; }
            .main-content { margin-left: 0 !important; }
            .mobile-header { display: flex !important; }
            .desktop-search { display: none !important; }
        }
        @media (min-width: 769px) {
            .mobile-header { display: none !important; }
            .sidebar-overlay { display: none !important; }
        }
        
        /* Tablet responsive */
        @media (max-width: 1024px) {
            .card { padding: 1rem; }
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
        }
        
        /* Small screens */
        @media (max-width: 640px) {
            .stats-grid { grid-template-columns: 1fr; }
            .card h3 { font-size: 1.5rem; }
            .modal > div { margin: 0.5rem; max-height: 95vh; }
            table { font-size: 0.75rem; }
            th, td { padding: 0.5rem 0.25rem; }
        }
        
        /* Large screens */
        @media (min-width: 1536px) {
            .main-content { max-width: 1400px; margin-left: auto; margin-right: auto; padding-left: 16rem; }
        }
        
        /* Scrollable tables */
        .table-container { overflow-x: auto; -webkit-overflow-scrolling: touch; }
        
        /* Touch-friendly buttons */
        @media (hover: none) {
            .btn-primary:hover { transform: none; }
            .nav-item { padding: 0.875rem 1rem; }
        }
    </style>
</head>
<body class="min-h-screen flex">
    <!-- Mobile Overlay -->
    <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>
    
    <!-- Sidebar -->
    <aside class="sidebar sidebar-bg w-64 min-h-screen flex flex-col fixed left-0 top-0 z-50" id="sidebar">
        <!-- Logo -->
        <div class="p-6 border-b border-white/10">
            <div class="flex items-center gap-3">
                <div class="bg-slate-700 rounded-lg p-2">
                    <img src="https://i.ibb.co/fGy3TCJd/logo-axxess-1.png" alt="Axxess" class="h-8">
                </div>
                <div>
                    <h1 class="text-white font-bold">Axxess</h1>
                    <p class="text-white/50 text-xs">Admin Portal</p>
                </div>
            </div>
        </div>

        <!-- Navigation -->
        <nav class="flex-1 p-4 space-y-2">
            <a href="#dashboard" class="nav-item active flex items-center gap-3 text-white px-4 py-3 rounded-xl" onclick="showSection('dashboard')">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z" />
                </svg>
                Dashboard
            </a>
            <a href="#leads" class="nav-item flex items-center gap-3 text-white/70 px-4 py-3 rounded-xl" onclick="showSection('leads')">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                </svg>
                Leads
            </a>
            <a href="#orders" class="nav-item flex items-center gap-3 text-white/70 px-4 py-3 rounded-xl" onclick="showSection('orders')">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
                </svg>
                Orders
            </a>
            <a href="#agents" class="nav-item flex items-center gap-3 text-white/70 px-4 py-3 rounded-xl" onclick="showSection('agents')">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" />
                </svg>
                Agents
            </a>
            <a href="#packages" class="nav-item flex items-center gap-3 text-white/70 px-4 py-3 rounded-xl" onclick="showSection('packages')">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" />
                </svg>
                Packages
            </a>
            <a href="#reports" class="nav-item flex items-center gap-3 text-white/70 px-4 py-3 rounded-xl" onclick="showSection('reports')">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                </svg>
                Reports
            </a>
            <a href="#import" class="nav-item flex items-center gap-3 text-white/70 px-4 py-3 rounded-xl" onclick="showSection('import')">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" />
                </svg>
                Import Leads
            </a>
            <a href="#dealers" class="nav-item flex items-center gap-3 text-white/70 px-4 py-3 rounded-xl" onclick="showSection('dealers')">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
                </svg>
                Dealers
            </a>
            <a href="#pending-agents" class="nav-item flex items-center gap-3 text-white/70 px-4 py-3 rounded-xl" onclick="showSection('pending-agents')">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z" />
                </svg>
                Pending Agents
                <span id="pendingAgentsBadge" class="hidden bg-orange-500 text-white text-xs px-2 py-0.5 rounded-full ml-auto">0</span>
            </a>
            <a href="#settings" class="nav-item flex items-center gap-3 text-white/70 px-4 py-3 rounded-xl" onclick="showSection('settings')">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                </svg>
                Settings
            </a>
        </nav>

        <!-- User Section -->
        <div class="p-4 border-t border-white/10">
            <div class="flex items-center gap-3 mb-4">
                <div class="w-10 h-10 bg-green-500 rounded-full flex items-center justify-center text-white font-bold">
                    <span id="userInitials">A</span>
                </div>
                <div>
                    <p class="text-white font-medium text-sm" id="userName">Admin</p>
                    <p class="text-white/50 text-xs">Administrator</p>
                </div>
            </div>
            <button onclick="logout()" class="w-full flex items-center justify-center gap-2 text-white/70 hover:text-white py-2 px-4 rounded-lg hover:bg-white/10 transition">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                </svg>
                Logout
            </button>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content main-bg flex-1 ml-64 min-h-screen">
        <!-- Header -->
        <header class="bg-white border-b px-4 md:px-8 py-4 flex items-center justify-between sticky top-0 z-40">
            <!-- Mobile menu button -->
            <button class="mobile-header p-2 -ml-2 text-gray-700 hover:bg-gray-100 rounded-xl" onclick="toggleSidebar()">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                </svg>
            </button>
            <div class="flex-1 md:flex-none">
                <h2 class="text-lg md:text-2xl font-bold text-gray-800" id="pageTitle">Dashboard</h2>
                <p class="text-gray-500 text-xs md:text-sm hidden md:block" id="pageSubtitle">Overview of your dealer network</p>
            </div>
            <div class="flex items-center gap-2 md:gap-4">
                <div class="relative desktop-search">
                    <input type="text" placeholder="Search..." class="pl-10 pr-4 py-2 border rounded-xl focus:outline-none focus:ring-2 focus:ring-green-500/20 focus:border-green-500 w-64">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400 absolute left-3 top-1/2 -translate-y-1/2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                </div>
                <button class="relative p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-xl">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
                    </svg>
                    <span class="absolute top-1 right-1 w-2 h-2 bg-green-500 rounded-full"></span>
                </button>
            </div>
        </header>

        <!-- Dashboard Section -->
        <section id="section-dashboard" class="p-3 md:p-4">
            <!-- Stats Cards -->
            <div class="grid grid-cols-2 lg:grid-cols-4 gap-2 md:gap-3 mb-3">
                <div class="card p-4">
                    <div class="flex items-center justify-between mb-2">
                        <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                            </svg>
                        </div>
                        <span class="text-green-500 text-xs font-medium">+12%</span>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-800" id="totalLeads">0</h3>
                    <p class="text-gray-500 text-xs">Total Leads</p>
                </div>

                <div class="card p-4">
                    <div class="flex items-center justify-between mb-2">
                        <div class="w-10 h-10 bg-gradient-to-br from-green-500 to-green-600 rounded-lg flex items-center justify-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                        </div>
                        <span class="text-green-500 text-xs font-medium">+8%</span>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-800" id="totalOrders">0</h3>
                    <p class="text-gray-500 text-xs">Active Orders</p>
                </div>

                <div class="card p-4">
                    <div class="flex items-center justify-between mb-2">
                        <div class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-purple-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" />
                            </svg>
                        </div>
                        <span class="text-green-500 text-xs font-medium">+3</span>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-800" id="totalAgents">0</h3>
                    <p class="text-gray-500 text-xs">Active Agents</p>
                </div>

                <div class="card p-4">
                    <div class="flex items-center justify-between mb-2">
                        <div class="w-10 h-10 bg-yellow-100 rounded-lg flex items-center justify-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-yellow-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
                            </svg>
                        </div>
                        <span class="text-green-500 text-xs font-medium">+15%</span>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-800" id="conversionRate">0%</h3>
                    <p class="text-gray-500 text-xs">Conversion Rate</p>
                </div>
            </div>

            <!-- Revenue Summary -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-2 md:gap-3 mb-3">
                <div class="card p-4 border-l-4 border-emerald-500">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-500 mb-1">Confirmed Revenue</p>
                            <h3 class="text-2xl font-bold text-emerald-600" id="confirmedRevenue">R0</h3>
                            <p class="text-xs text-gray-400 mt-1"><span id="confirmedCount">0</span> leads confirmed</p>
                        </div>
                        <div class="w-12 h-12 bg-emerald-100 rounded-xl flex items-center justify-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-emerald-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                        </div>
                    </div>
                </div>
                <div class="card p-4 border-l-4 border-amber-500">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-500 mb-1">Pending Revenue</p>
                            <h3 class="text-2xl font-bold text-amber-600" id="pendingRevenue">R0</h3>
                            <p class="text-xs text-gray-400 mt-1"><span id="pendingCount">0</span> leads pending</p>
                        </div>
                        <div class="w-12 h-12 bg-amber-100 rounded-xl flex items-center justify-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-amber-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                        </div>
                    </div>
                </div>
                <div class="card p-4 border-l-4 border-red-400">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-500 mb-1">Rejected/Lost</p>
                            <h3 class="text-2xl font-bold text-red-500" id="rejectedRevenue">R0</h3>
                            <p class="text-xs text-gray-400 mt-1"><span id="rejectedCount">0</span> leads rejected</p>
                        </div>
                        <div class="w-12 h-12 bg-red-100 rounded-xl flex items-center justify-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Charts Row -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-3 mb-3">
                <div class="card p-4">
                    <h3 class="text-base font-semibold text-gray-800 mb-2">Orders Overview</h3>
                    <canvas id="ordersChart" height="140"></canvas>
                </div>
                <div class="card p-4">
                    <h3 class="text-base font-semibold text-gray-800 mb-2">Lead Sources</h3>
                    <canvas id="leadsChart" height="140"></canvas>
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="card p-4">
                <div class="flex items-center justify-between mb-3">
                    <h3 class="text-lg font-semibold text-gray-800">Recent Orders</h3>
                    <a href="#orders" onclick="showSection('orders')" class="text-green-500 hover:text-green-600 text-sm font-medium">View All</a>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead>
                            <tr class="text-left text-gray-500 text-sm border-b">
                                <th class="pb-4 font-medium">Client</th>
                                <th class="pb-4 font-medium">Package</th>
                                <th class="pb-4 font-medium">Agent</th>
                                <th class="pb-4 font-medium">Status</th>
                                <th class="pb-4 font-medium">Date</th>
                                <th class="pb-4 font-medium">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="recentOrdersTable">
                            <tr class="table-row border-b">
                                <td class="py-4" colspan="6">
                                    <p class="text-gray-500 text-center">Loading...</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Leads Section -->
        <section id="section-leads" class="p-8 hidden">
            <div class="flex items-center justify-between mb-6">
                <div class="flex items-center gap-4">
                    <select id="leadStatusFilter" class="border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-red-500/20">
                        <option value="">All Status</option>
                        <option value="new">New</option>
                        <option value="contacted">Contacted</option>
                        <option value="qualified">Qualified</option>
                        <option value="converted">Converted</option>
                        <option value="lost">Lost</option>
                    </select>
                    <select id="leadAgentFilter" class="border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-red-500/20">
                        <option value="">All Agents</option>
                    </select>
                </div>
                <button onclick="openModal('addLeadModal')" class="btn-primary text-white px-6 py-2 rounded-xl font-medium flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                    </svg>
                    Add Lead
                </button>
            </div>

            <div class="card p-6">
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead>
                            <tr class="text-left text-gray-500 text-sm border-b">
                                <th class="pb-4 font-medium">Client Name</th>
                                <th class="pb-4 font-medium">Contact</th>
                                <th class="pb-4 font-medium">Address</th>
                                <th class="pb-4 font-medium">Package Interest</th>
                                <th class="pb-4 font-medium">Agent</th>
                                <th class="pb-4 font-medium">Status</th>
                                <th class="pb-4 font-medium">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="leadsTable">
                            <tr class="table-row border-b">
                                <td class="py-4" colspan="7">
                                    <p class="text-gray-500 text-center">Loading leads...</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Orders Section -->
        <section id="section-orders" class="p-8 hidden">
            <div class="flex items-center justify-between mb-6">
                <div class="flex items-center gap-4">
                    <select id="orderStatusFilter" class="border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-red-500/20">
                        <option value="">All Status</option>
                        <option value="pending">Pending</option>
                        <option value="processing">Processing</option>
                        <option value="scheduled">Scheduled</option>
                        <option value="completed">Completed</option>
                        <option value="cancelled">Cancelled</option>
                    </select>
                    <select id="orderAgentFilter" class="border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-red-500/20">
                        <option value="">All Agents</option>
                    </select>
                </div>
            </div>

            <div class="card p-6">
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead>
                            <tr class="text-left text-gray-500 text-sm border-b">
                                <th class="pb-4 font-medium">Order ID</th>
                                <th class="pb-4 font-medium">Client</th>
                                <th class="pb-4 font-medium">Package</th>
                                <th class="pb-4 font-medium">Agent</th>
                                <th class="pb-4 font-medium">Status</th>
                                <th class="pb-4 font-medium">Created</th>
                                <th class="pb-4 font-medium">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="ordersTable">
                            <tr class="table-row border-b">
                                <td class="py-4" colspan="7">
                                    <p class="text-gray-500 text-center">Loading orders...</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Agents Section -->
        <section id="section-agents" class="p-8 hidden">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-lg font-semibold text-gray-800">Manage Agents</h3>
                <button onclick="openModal('addAgentModal')" class="btn-primary text-white px-6 py-2 rounded-xl font-medium flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                    </svg>
                    Add Agent
                </button>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="agentsGrid">
                <div class="card p-6 text-center">
                    <p class="text-gray-500">Loading agents...</p>
                </div>
            </div>
        </section>

        <!-- Packages Section -->
        <section id="section-packages" class="p-8 hidden">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-lg font-semibold text-gray-800">Openserve Packages</h3>
                <button onclick="openModal('addPackageModal')" class="btn-primary text-white px-6 py-2 rounded-xl font-medium flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                    </svg>
                    Add Package
                </button>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="packagesGrid">
                <div class="card p-6 text-center">
                    <p class="text-gray-500">Loading packages...</p>
                </div>
            </div>
        </section>

        <!-- Reports Section -->
        <section id="section-reports" class="p-8 hidden">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="card p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Agent Performance</h3>
                    <canvas id="agentPerformanceChart" height="250"></canvas>
                </div>
                <div class="card p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Monthly Conversions</h3>
                    <canvas id="monthlyConversionsChart" height="250"></canvas>
                </div>
            </div>
        </section>

        <!-- Import Section -->
        <section id="section-import" class="p-4 md:p-8 hidden">
            <div class="card p-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-2">Mass Import Leads</h3>
                <p class="text-gray-500 text-sm mb-6">Upload a CSV file to import multiple leads at once. Leads will be assigned to dealers and agents as specified.</p>

                <div class="mb-6">
                    <h4 class="font-medium text-gray-700 mb-2">CSV Format Requirements:</h4>
                    <div class="bg-gray-50 rounded-xl p-4 text-sm text-gray-600 overflow-x-auto">
                        <p class="mb-2">Your CSV file should have the following columns:</p>
                        <code class="bg-gray-200 px-2 py-1 rounded text-xs whitespace-nowrap">LEAD ID, AGENT, DEALER, DEAL, ISP, LEAD TYPE, STATUS, REGION, PRIMARY CONTACT NAME, PRIMARY CONTACT NUMBER, PRIMARY CONTACT EMAIL, SECONDARY CONTACT NAME, SECONDARY CONTACT NUMBER, SECONDARY CONTACT SECONDARY, SECONDARY CONTACT EMAIL, ORDER NUMBER, ORDER STATUS, ORDER DATE, DATE CAPTURED, LAST UPDATED, CAPTURED BY, SECONDARY CONTACT</code>
                        <ul class="mt-3 space-y-1 text-gray-500 text-xs">
                            <li>• <strong>LEAD ID</strong> - Unique identifier to avoid duplicates</li>
                            <li>• <strong>AGENT</strong> - Agent name or email</li>
                            <li>• <strong>DEALER</strong> - Dealer name</li>
                            <li>• <strong>DEAL</strong> - Package/deal name</li>
                            <li>• <strong>PRIMARY CONTACT NAME</strong> - Client's full name</li>
                            <li>• <strong>PRIMARY CONTACT NUMBER</strong> - Client's phone</li>
                            <li>• <strong>PRIMARY CONTACT EMAIL</strong> - Client's email</li>
                            <li>• <strong>STATUS</strong> - Lead status (new, contacted, qualified, etc.)</li>
                            <li>• <strong>REGION</strong> - Client's address/region</li>
                        </ul>
                    </div>
                </div>

                <div class="mb-6">
                    <a href="#" onclick="downloadTemplate()" class="text-emerald-600 hover:text-emerald-700 font-medium flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                        </svg>
                        Download CSV Template
                    </a>
                </div>

                <div class="border-2 border-dashed border-gray-300 rounded-xl p-8 text-center" id="dropZone">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-gray-400 mx-auto mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                    </svg>
                    <p class="text-gray-600 mb-2">Drag and drop your CSV file here, or</p>
                    <label class="btn-primary text-white px-6 py-2 rounded-xl font-medium cursor-pointer inline-block">
                        Browse Files
                        <input type="file" accept=".csv" class="hidden" id="csvFileInput" onchange="handleFileSelect(event)">
                    </label>
                </div>

                <div id="importPreview" class="mt-6 hidden">
                    <h4 class="font-medium text-gray-700 mb-4">Preview (first 5 rows):</h4>
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm" id="previewTable"></table>
                    </div>
                    <div class="mt-4 flex gap-4">
                        <button onclick="confirmImport()" class="btn-primary text-white px-6 py-2 rounded-xl font-medium">
                            Import <span id="importCount">0</span> Leads
                        </button>
                        <button onclick="cancelImport()" class="border px-6 py-2 rounded-xl hover:bg-gray-50">
                            Cancel
                        </button>
                    </div>
                </div>

                <div id="importProgress" class="mt-6 hidden">
                    <div class="flex items-center gap-4">
                        <div class="flex-1 bg-gray-200 rounded-full h-2">
                            <div id="progressBar" class="bg-emerald-500 h-2 rounded-full transition-all" style="width: 0%"></div>
                        </div>
                        <span id="progressText" class="text-sm text-gray-600">0%</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Dealers Section -->
        <section id="section-dealers" class="p-4 md:p-8 hidden">
            <div class="flex flex-col md:flex-row items-start md:items-center justify-between mb-6 gap-4">
                <h3 class="text-lg font-semibold text-gray-800">Dealer Management</h3>
                <button onclick="openModal('addDealerModal')" class="btn-primary text-white px-6 py-2 rounded-xl font-medium flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                    </svg>
                    Add Dealer
                </button>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="dealersGrid">
                <div class="card p-6 text-center">
                    <p class="text-gray-500">Loading dealers...</p>
                </div>
            </div>
        </section>

        <!-- Pending Agents Section -->
        <section id="section-pending-agents" class="p-4 md:p-8 hidden">
            <div class="mb-6">
                <h3 class="text-lg font-semibold text-gray-800">Pending Agent Approvals</h3>
                <p class="text-gray-500 text-sm">Review and approve agents imported from CSV files</p>
            </div>
            <div class="card overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr class="text-left text-gray-500 text-sm">
                                <th class="px-6 py-4 font-medium">Name</th>
                                <th class="px-6 py-4 font-medium">Email</th>
                                <th class="px-6 py-4 font-medium">Dealer</th>
                                <th class="px-6 py-4 font-medium">Date Added</th>
                                <th class="px-6 py-4 font-medium">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="pendingAgentsTable">
                            <tr class="border-t">
                                <td class="px-6 py-4" colspan="5">
                                    <p class="text-gray-500 text-center">No pending agents</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Settings Section -->
        <section id="section-settings" class="p-4 md:p-8 hidden">
            <div class="mb-6">
                <h3 class="text-lg font-semibold text-gray-800">System Settings</h3>
                <p class="text-gray-500 text-sm">Configure system-wide settings and integrations</p>
            </div>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Supabase Configuration -->
                <div class="card p-6">
                    <div class="flex items-start gap-3 mb-4">
                        <div class="w-10 h-10 bg-emerald-100 rounded-xl flex items-center justify-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-emerald-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4" />
                            </svg>
                        </div>
                        <div>
                            <h4 class="font-semibold text-gray-800">Supabase Configuration</h4>
                            <p class="text-sm text-gray-500">Database connection settings</p>
                        </div>
                    </div>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Supabase Project URL</label>
                            <input type="url" id="supabaseUrlSetting" class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-emerald-500/20" placeholder="https://your-project.supabase.co">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Supabase API Key (anon public)</label>
                            <textarea id="supabaseKeySetting" rows="2" class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-emerald-500/20 text-xs" placeholder="Enter your anon key"></textarea>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="saveSupabaseConfig()" class="btn-primary text-white px-4 py-2 rounded-xl text-sm">Save Configuration</button>
                            <button onclick="testSupabaseConnection()" class="border px-4 py-2 rounded-xl text-sm hover:bg-gray-50">Test Connection</button>
                        </div>
                        <div id="supabaseConfigStatus" class="p-3 bg-gray-50 rounded-xl text-sm text-gray-600">
                            <strong>Status:</strong> <span id="supabaseStatusText">Checking...</span>
                        </div>
                    </div>
                </div>

                <!-- Openserve API Integration -->
                <div class="card p-6">
                    <div class="flex items-start justify-between mb-4">
                        <div>
                            <h4 class="font-semibold text-gray-800 flex items-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-emerald-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 9l3 3-3 3m5 0h3M5 20h14a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                                </svg>
                                Openserve API Integration
                            </h4>
                            <p class="text-sm text-gray-500 mt-1">Connect to Openserve for live fibre availability data</p>
                        </div>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="openserveApiToggle" class="sr-only peer" onchange="toggleOpenserveApi(this.checked)">
                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-emerald-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-emerald-600"></div>
                        </label>
                    </div>
                    <div id="openserveApiConfig" class="hidden space-y-4 pt-4 border-t">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">API URL</label>
                            <input type="url" id="openserveApiUrl" class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-emerald-500/20" placeholder="https://api.openserve.co.za">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">API Key</label>
                            <input type="password" id="openserveApiKey" class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-emerald-500/20" placeholder="Enter your API key">
                        </div>
                        <button onclick="saveOpenserveConfig()" class="btn-primary text-white px-4 py-2 rounded-xl text-sm">Save Configuration</button>
                    </div>
                    <div class="mt-4 p-3 bg-amber-50 rounded-xl text-sm text-amber-700" id="openserveApiStatus">
                        <strong>Status:</strong> Inactive - Enable to connect to live Openserve data
                    </div>
                </div>

                <!-- General Settings -->
                <div class="card p-6">
                    <h4 class="font-semibold text-gray-800 mb-4">General Settings</h4>
                    <div class="space-y-4">
                        <div class="flex items-center justify-between py-3 border-b">
                            <div>
                                <p class="font-medium text-gray-700">Auto-approve agents</p>
                                <p class="text-sm text-gray-500">Skip approval for new agents from CSV</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="autoApproveAgents" class="sr-only peer">
                                <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-emerald-600"></div>
                            </label>
                        </div>
                        <div class="flex items-center justify-between py-3 border-b">
                            <div>
                                <p class="font-medium text-gray-700">Email notifications</p>
                                <p class="text-sm text-gray-500">Get notified for new leads and orders</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="emailNotifications" class="sr-only peer" checked>
                                <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-emerald-600"></div>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Add Lead Modal -->
    <div id="addLeadModal" class="modal fixed inset-0 bg-black/50 items-center justify-center z-50">
        <div class="bg-white rounded-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto m-4">
            <div class="p-6 border-b flex items-center justify-between">
                <h3 class="text-xl font-semibold">Add New Lead</h3>
                <button onclick="closeModal('addLeadModal')" class="text-gray-400 hover:text-gray-600">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <form id="addLeadForm" class="p-6 space-y-4">
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">First Name *</label>
                        <input type="text" name="first_name" required class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-red-500/20">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Last Name *</label>
                        <input type="text" name="last_name" required class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-red-500/20">
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Email *</label>
                        <input type="email" name="email" required class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-red-500/20">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Phone *</label>
                        <input type="tel" name="phone" required class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-red-500/20">
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">ID Number</label>
                        <input type="text" name="id_number" class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-emerald-500/20" placeholder="SA ID Number">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Address *</label>
                        <input type="text" name="address" required class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-emerald-500/20">
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Package Interest</label>
                        <select name="package_id" class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-red-500/20" id="leadPackageSelect">
                            <option value="">Select Package</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Assign to Agent</label>
                        <select name="agent_id" class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-red-500/20" id="leadAgentSelect">
                            <option value="">Select Agent</option>
                        </select>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Notes</label>
                    <textarea name="notes" rows="3" class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-red-500/20"></textarea>
                </div>
                <div class="flex justify-end gap-3 pt-4">
                    <button type="button" onclick="closeModal('addLeadModal')" class="px-6 py-2 border rounded-xl hover:bg-gray-50">Cancel</button>
                    <button type="submit" class="btn-primary text-white px-6 py-2 rounded-xl">Add Lead</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Agent Modal -->
    <div id="addAgentModal" class="modal fixed inset-0 bg-black/50 items-center justify-center z-50">
        <div class="bg-white rounded-2xl w-full max-w-md m-4">
            <div class="p-6 border-b flex items-center justify-between">
                <h3 class="text-xl font-semibold">Add New Agent</h3>
                <button onclick="closeModal('addAgentModal')" class="text-gray-400 hover:text-gray-600">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <form id="addAgentForm" class="p-6 space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Full Name *</label>
                    <input type="text" name="full_name" required class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-red-500/20">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Email *</label>
                    <input type="email" name="email" required class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-red-500/20">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Password *</label>
                    <input type="password" name="password" required minlength="6" class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-red-500/20">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Phone</label>
                    <input type="tel" name="phone" class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-red-500/20">
                </div>
                <div class="flex justify-end gap-3 pt-4">
                    <button type="button" onclick="closeModal('addAgentModal')" class="px-6 py-2 border rounded-xl hover:bg-gray-50">Cancel</button>
                    <button type="submit" class="btn-primary text-white px-6 py-2 rounded-xl">Create Agent</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Package Modal -->
    <div id="addPackageModal" class="modal fixed inset-0 bg-black/50 items-center justify-center z-50">
        <div class="bg-white rounded-2xl w-full max-w-md m-4">
            <div class="p-6 border-b flex items-center justify-between">
                <h3 class="text-xl font-semibold">Add New Package</h3>
                <button onclick="closeModal('addPackageModal')" class="text-gray-400 hover:text-gray-600">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <form id="addPackageForm" class="p-6 space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Package Name *</label>
                    <input type="text" name="name" required class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-red-500/20" placeholder="e.g., Fibre 50Mbps">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Speed (Mbps) *</label>
                    <input type="number" name="speed" required class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-red-500/20" placeholder="50">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Monthly Price (R) *</label>
                    <input type="number" name="price" required step="0.01" class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-red-500/20" placeholder="699.00">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                    <textarea name="description" rows="3" class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-red-500/20"></textarea>
                </div>
                <div class="flex justify-end gap-3 pt-4">
                    <button type="button" onclick="closeModal('addPackageModal')" class="px-6 py-2 border rounded-xl hover:bg-gray-50">Cancel</button>
                    <button type="submit" class="btn-primary text-white px-6 py-2 rounded-xl">Add Package</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Return to Agent Modal -->
    <div id="returnToAgentModal" class="modal fixed inset-0 bg-black/50 items-center justify-center z-50">
        <div class="bg-white rounded-2xl w-full max-w-md m-4">
            <div class="p-6 border-b flex items-center justify-between">
                <h3 class="text-xl font-semibold">Return to Agent</h3>
                <button onclick="closeModal('returnToAgentModal')" class="text-gray-400 hover:text-gray-600">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <form id="returnToAgentForm" class="p-6 space-y-4">
                <input type="hidden" name="item_id" id="returnItemId">
                <input type="hidden" name="item_type" id="returnItemType">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Reason for Return *</label>
                    <textarea name="return_reason" required rows="3" class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-red-500/20" placeholder="Please provide a reason..."></textarea>
                </div>
                <div class="flex justify-end gap-3 pt-4">
                    <button type="button" onclick="closeModal('returnToAgentModal')" class="px-6 py-2 border rounded-xl hover:bg-gray-50">Cancel</button>
                    <button type="submit" class="btn-primary text-white px-6 py-2 rounded-xl">Return</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Dealer Modal -->
    <div id="addDealerModal" class="modal fixed inset-0 bg-black/50 items-center justify-center z-50">
        <div class="bg-white rounded-2xl w-full max-w-md m-4">
            <div class="p-6 border-b flex items-center justify-between">
                <h3 class="text-xl font-semibold">Add New Dealer</h3>
                <button onclick="closeModal('addDealerModal')" class="text-gray-400 hover:text-gray-600">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <form id="addDealerForm" class="p-6 space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Dealer Name *</label>
                    <input type="text" name="name" required class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-emerald-500/20">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Dealer Code</label>
                    <input type="text" name="code" class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-emerald-500/20" placeholder="e.g., MTL">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Contact Email</label>
                    <input type="email" name="contact_email" class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-emerald-500/20">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Contact Phone</label>
                    <input type="tel" name="contact_phone" class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-emerald-500/20">
                </div>
                <div class="flex justify-end gap-3 pt-4">
                    <button type="button" onclick="closeModal('addDealerModal')" class="px-6 py-2 border rounded-xl hover:bg-gray-50">Cancel</button>
                    <button type="submit" class="btn-primary text-white px-6 py-2 rounded-xl">Add Dealer</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Approve Agent Modal -->
    <div id="approveAgentModal" class="modal fixed inset-0 bg-black/50 items-center justify-center z-50">
        <div class="bg-white rounded-2xl w-full max-w-md m-4">
            <div class="p-6 border-b flex items-center justify-between">
                <h3 class="text-xl font-semibold">Approve Agent</h3>
                <button onclick="closeModal('approveAgentModal')" class="text-gray-400 hover:text-gray-600">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <form id="approveAgentForm" class="p-6 space-y-4">
                <input type="hidden" name="pending_agent_id" id="pendingAgentId">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Full Name *</label>
                    <input type="text" name="full_name" id="approveAgentName" required class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-emerald-500/20">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Email *</label>
                    <input type="email" name="email" id="approveAgentEmail" required readonly class="w-full border rounded-xl px-4 py-2 bg-gray-50">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Password *</label>
                    <input type="password" name="password" required minlength="6" class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-emerald-500/20" placeholder="Set password for agent">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Phone</label>
                    <input type="tel" name="phone" class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-emerald-500/20">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Assign to Dealer</label>
                    <select name="dealer_id" id="approveAgentDealer" class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-emerald-500/20">
                        <option value="">No dealer</option>
                    </select>
                </div>
                <div class="flex justify-end gap-3 pt-4">
                    <button type="button" onclick="closeModal('approveAgentModal')" class="px-6 py-2 border rounded-xl hover:bg-gray-50">Cancel</button>
                    <button type="submit" class="btn-primary text-white px-6 py-2 rounded-xl">Approve & Create</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Convert to Order Modal -->
    <div id="convertToOrderModal" class="modal fixed inset-0 bg-black/50 items-center justify-center z-50">
        <div class="bg-white rounded-2xl w-full max-w-md m-4">
            <div class="p-6 border-b flex items-center justify-between">
                <h3 class="text-xl font-semibold">Convert Lead to Order</h3>
                <button onclick="closeModal('convertToOrderModal')" class="text-gray-400 hover:text-gray-600">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <div class="p-6 space-y-4">
                <div class="bg-blue-50 border border-blue-200 rounded-xl p-4">
                    <p class="text-sm text-blue-800">Converting: <strong id="convertLeadName">-</strong></p>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Order Number *</label>
                    <input type="text" id="convertOrderNumber" required class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-emerald-500/20" placeholder="e.g. ORD-12345">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Product Type *</label>
                    <select id="convertProductType" class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-emerald-500/20">
                        <option value="postpaid">Postpaid (R200 commission)</option>
                        <option value="prepaid" disabled>Prepaid (R100 commission) - Coming Soon</option>
                    </select>
                </div>
                <div class="bg-gray-50 rounded-xl p-4">
                    <p class="text-sm text-gray-600">Commission will be calculated based on product type:</p>
                    <ul class="text-sm text-gray-500 mt-2 space-y-1">
                        <li>• <strong>Postpaid:</strong> R200 per active service</li>
                        <li>• <strong>Prepaid:</strong> R100 per active service (coming soon)</li>
                    </ul>
                </div>
                <div class="flex justify-end gap-3 pt-4">
                    <button type="button" onclick="closeModal('convertToOrderModal')" class="px-6 py-2 border rounded-xl hover:bg-gray-50">Cancel</button>
                    <button onclick="convertToOrder()" class="bg-emerald-600 hover:bg-emerald-700 text-white px-6 py-2 rounded-xl font-medium">Convert to Order</button>
                </div>
            </div>
        </div>
    </div>

    <script src="js/supabase-config.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/admin-dashboard.js"></script>
    <script>
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            sidebar.classList.toggle('open');
            overlay.classList.toggle('active');
        }
        
        // Close sidebar when clicking a nav item on mobile
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', () => {
                if (window.innerWidth < 769) {
                    toggleSidebar();
                }
            });
        });
    </script>
</body>
</html>
