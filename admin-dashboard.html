<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Axxess Dealer Portal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { font-family: 'Poppins', sans-serif; }
        /* Axxess Blue with subtle Openserve Green - lighter shade */
        :root {
            --axxess-blue: #2c4a6e;
            --axxess-blue-dark: #1a3a5c;
            --axxess-blue-light: #3d5a7e;
            --openserve-green: #10b981;
            --openserve-green-light: #34d399;
            --accent-50: #eff6ff;
            --accent-100: #dbeafe;
            --accent-500: #3b82f6;
            --accent-600: #2563eb;
            --accent-700: #1d4ed8;
        }
        .sidebar-bg { 
            background: linear-gradient(180deg, var(--axxess-blue) 0%, var(--axxess-blue-light) 100%);
        }
        .main-bg { background: #f1f5f9; }
        .card { 
            background: white; 
            border-radius: 0.75rem; 
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
            border: 1px solid #e2e8f0;
        }
        .btn-primary { 
            background: linear-gradient(135deg, var(--axxess-blue) 0%, var(--axxess-blue-dark) 100%);
            transition: all 0.2s ease;
        }
        .btn-primary:hover { 
            transform: translateY(-1px); 
            box-shadow: 0 4px 14px rgba(30, 58, 95, 0.4);
            background: linear-gradient(135deg, var(--axxess-blue-light) 0%, var(--axxess-blue) 100%);
        }
        .btn-success {
            background: linear-gradient(135deg, var(--openserve-green) 0%, #059669 100%);
        }
        .status-new { background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); color: #1e40af; }
        .status-lead { background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); color: #92400e; }
        .status-pending { background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); color: #92400e; }
        .status-contacted { background: linear-gradient(135deg, #e0e7ff 0%, #c7d2fe 100%); color: #3730a3; }
        .status-qualified { background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%); color: #065f46; }
        .status-processing { background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); color: #1e40af; }
        .status-scheduled { background: linear-gradient(135deg, #e0e7ff 0%, #c7d2fe 100%); color: #3730a3; }
        .status-completed { background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%); color: #065f46; }
        .status-converted { background: linear-gradient(135deg, #bbf7d0 0%, #86efac 100%); color: #166534; }
        .status-cancelled { background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%); color: #991b1b; }
        .status-returned { background: linear-gradient(135deg, #fce7f3 0%, #fbcfe8 100%); color: #9d174d; }
        .status-lost { background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%); color: #4b5563; }
        
        /* Modern Select Dropdown */
        select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%236b7280'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 0.5rem center;
            background-size: 1rem;
            padding-right: 2rem;
            cursor: pointer;
            border-radius: 0.5rem;
            transition: all 0.2s ease;
        }
        select:hover {
            border-color: var(--axxess-blue);
        }
        select:focus {
            outline: none;
            border-color: var(--openserve-green);
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }
        .nav-item { transition: all 0.2s ease; border-radius: 0.5rem; }
        .nav-item:hover { background: rgba(255,255,255,0.1); }
        .nav-item.active { background: rgba(16, 185, 129, 0.2); border-left: 3px solid var(--openserve-green); }
        .table-row:hover { background: #f8fafc; }
        .modal { display: none; }
        .modal.active { display: flex; }
        /* Modal overlay for Axxess modals */
        .modal-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 50; justify-content: center; align-items: center; }
        .modal-overlay.active { display: flex; }
        .modal-container { background: white; border-radius: 1rem; width: 90%; box-shadow: 0 20px 60px rgba(0,0,0,0.2); overflow: hidden; }
        .modal-container .modal-header { display: flex; justify-content: space-between; align-items: center; padding: 1rem 1.5rem; border-bottom: 1px solid #e2e8f0; }
        .modal-container .modal-header button { font-size: 1.5rem; line-height: 1; }
        /* Axxess sub-tabs */
        .ax-tab-btn { color: #6b7280; background: transparent; }
        .ax-tab-btn:hover { background: rgba(0,0,0,0.05); }
        .ax-tab-btn.active { background: white; color: var(--axxess-blue); box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        /* Refined card hover */
        .card:hover { box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
        /* Accent border */
        .accent-border { border-left: 4px solid var(--primary-500); }
        
        /* Mobile Responsive */
        @media (max-width: 768px) {
            .sidebar { transform: translateX(-100%); transition: transform 0.3s ease; }
            .sidebar.open { transform: translateX(0); }
            .sidebar-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 40; }
            .sidebar-overlay.active { display: block; }
            .main-content { margin-left: 0 !important; }
            .mobile-header { display: flex !important; }
            .desktop-search { display: none !important; }
        }
        @media (min-width: 769px) {
            .mobile-header { display: none !important; }
            .sidebar-overlay { display: none !important; }
        }
        
        /* Tablet responsive */
        @media (max-width: 1024px) {
            .card { padding: 1rem; }
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
        }
        
        /* Small screens */
        @media (max-width: 640px) {
            .stats-grid { grid-template-columns: 1fr; }
            .card h3 { font-size: 1.5rem; }
            .modal > div { margin: 0.5rem; max-height: 95vh; }
            table { font-size: 0.75rem; }
            th, td { padding: 0.5rem 0.25rem; }
        }
        
        /* Large screens - use full width */
        @media (min-width: 1536px) {
            .main-content { max-width: none; }
        }
        
        /* Scrollable tables */
        .table-container { overflow-x: auto; -webkit-overflow-scrolling: touch; }
        
        /* Touch-friendly buttons */
        @media (hover: none) {
            .btn-primary:hover { transform: none; }
            .nav-item { padding: 0.875rem 1rem; }
        }
    </style>
</head>
<body class="min-h-screen flex">
    <!-- Mobile Overlay -->
    <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>
    
    <!-- Sidebar -->
    <aside class="sidebar sidebar-bg w-80 min-h-screen flex flex-col fixed left-0 top-0 z-50" id="sidebar">
        <!-- Logo -->
        <div class="p-6 border-b border-white/10">
            <div class="flex items-center gap-3">
                <img src="https://i.ibb.co/fGy3TCJd/logo-axxess-1.png" alt="Axxess" class="h-12">
                <div>
                    <h1 class="text-white font-bold">Axxess</h1>
                    <p class="text-white/50 text-xs">Admin Portal</p>
                </div>
            </div>
        </div>

        <!-- Navigation -->
        <nav class="flex-1 p-4 space-y-2">
            <a href="#dashboard" class="nav-item active flex items-center gap-3 text-white px-4 py-3 rounded-xl" onclick="showSection('dashboard')">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z" />
                </svg>
                Dashboard
            </a>
            <a href="#leads" class="nav-item flex items-center gap-3 text-white/70 px-4 py-3 rounded-xl" onclick="showSection('leads')">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                </svg>
                Leads
            </a>
            <a href="#orders" class="nav-item flex items-center gap-3 text-white/70 px-4 py-3 rounded-xl" onclick="showSection('orders')">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
                </svg>
                Orders
            </a>
            <a href="#payments" class="nav-item flex items-center gap-3 text-white/70 px-4 py-3 rounded-xl" onclick="showSection('payments')">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z" />
                </svg>
                Payments
                <span id="paymentsBadge" class="hidden bg-red-500 text-white text-xs px-2 py-0.5 rounded-full ml-auto">0</span>
            </a>
            <a href="#agents" class="nav-item flex items-center gap-3 text-white/70 px-4 py-3 rounded-xl" onclick="showSection('agents')">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" />
                </svg>
                Agents
            </a>
            <a href="#packages" class="nav-item flex items-center gap-3 text-white/70 px-4 py-3 rounded-xl" onclick="showSection('packages')">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" />
                </svg>
                Packages
            </a>
            <a href="#reports" class="nav-item flex items-center gap-3 text-white/70 px-4 py-3 rounded-xl" onclick="showSection('reports')">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                </svg>
                Reports
            </a>
            <a href="#preorders" class="nav-item flex items-center gap-3 text-white/70 px-4 py-3 rounded-xl" onclick="showSection('preorders')">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                Preorders
                <span id="preordersBadge" class="hidden bg-purple-500 text-white text-xs px-2 py-0.5 rounded-full ml-auto">0</span>
            </a>
            <a href="#shipping" class="nav-item flex items-center gap-3 text-white/70 px-4 py-3 rounded-xl" onclick="showSection('shipping')">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4" />
                </svg>
                Shipping
                <span id="shippingBadge" class="hidden bg-orange-500 text-white text-xs px-2 py-0.5 rounded-full ml-auto">0</span>
            </a>
            <a href="#returned" class="nav-item flex items-center gap-3 text-white/70 px-4 py-3 rounded-xl" onclick="showSection('returned')">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6" />
                </svg>
                Returned Items
                <span id="returnedItemsBadge" class="hidden bg-pink-500 text-white text-xs px-2 py-0.5 rounded-full ml-auto">0</span>
            </a>
            <a href="#import" class="nav-item flex items-center gap-3 text-white/70 px-4 py-3 rounded-xl" onclick="showSection('import')">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" />
                </svg>
                Import Leads
            </a>
            <a href="#dealers" class="nav-item flex items-center gap-3 text-white/70 px-4 py-3 rounded-xl" onclick="showSection('dealers')">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
                </svg>
                Dealers
            </a>
            <a href="#pending-agents" class="nav-item flex items-center gap-3 text-white/70 px-4 py-3 rounded-xl" onclick="showSection('pending-agents')">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z" />
                </svg>
                Pending Agents
                <span id="pendingAgentsBadge" class="hidden bg-orange-500 text-white text-xs px-2 py-0.5 rounded-full ml-auto">0</span>
            </a>
            <a href="#axxess-sales" class="nav-item flex items-center gap-3 text-white/70 px-4 py-3 rounded-xl" onclick="showSection('axxess-sales')">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
                </svg>
                Axxess Sales
            </a>
            <a href="#settings" class="nav-item flex items-center gap-3 text-white/70 px-4 py-3 rounded-xl" onclick="showSection('settings')">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                </svg>
                Settings
            </a>
        </nav>

        <!-- User Section -->
        <div class="p-4 border-t border-white/10">
            <div class="flex items-center gap-3 mb-4">
                <div class="w-10 h-10 bg-green-500 rounded-full flex items-center justify-center text-white font-bold">
                    <span id="userInitials">A</span>
                </div>
                <div>
                    <p class="text-white font-medium text-sm" id="userName">Admin</p>
                    <p class="text-white/50 text-xs">Administrator</p>
                </div>
            </div>
            <button onclick="logout()" class="w-full flex items-center justify-center gap-2 text-white/70 hover:text-white py-2 px-4 rounded-lg hover:bg-white/10 transition">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                </svg>
                Logout
            </button>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content main-bg flex-1 ml-80 min-h-screen">
        <!-- Header -->
        <header class="bg-white border-b px-4 md:px-8 py-4 flex items-center justify-between sticky top-0 z-40">
            <!-- Mobile menu button -->
            <button class="mobile-header p-2 -ml-2 text-gray-700 hover:bg-gray-100 rounded-xl" onclick="toggleSidebar()">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                </svg>
            </button>
            <div class="flex-1 md:flex-none">
                <h2 class="text-lg md:text-2xl font-bold text-gray-800" id="pageTitle">Dashboard</h2>
                <p class="text-gray-500 text-xs md:text-sm hidden md:block" id="pageSubtitle">Overview of your dealer network</p>
            </div>
            <div class="flex items-center gap-2 md:gap-4">
                <div class="relative desktop-search">
                    <input type="text" id="globalSearch" placeholder="Search leads..." class="pl-10 pr-4 py-2 border rounded-xl focus:outline-none focus:ring-2 focus:ring-green-500/20 focus:border-green-500 w-64" oninput="globalSearchHandler(this.value)">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400 absolute left-3 top-1/2 -translate-y-1/2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                </div>
                <button onclick="toggleNotifications()" class="relative p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-xl" id="notificationBtn">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
                    </svg>
                    <span id="notificationBadge" class="absolute top-1 right-1 w-2 h-2 bg-green-500 rounded-full hidden"></span>
                </button>
                <!-- Notifications Dropdown -->
                <div id="notificationsDropdown" class="hidden absolute right-4 top-16 w-80 bg-white rounded-xl shadow-lg border z-50">
                    <div class="p-4 border-b">
                        <h4 class="font-semibold text-gray-800">Notifications</h4>
                    </div>
                    <div id="notificationsList" class="max-h-80 overflow-y-auto">
                        <p class="p-4 text-gray-500 text-sm text-center">No new notifications</p>
                    </div>
                </div>
            </div>
        </header>

        <!-- Dashboard Section - Vuma-Style ISP Portal -->
        <section id="section-dashboard" class="p-6 md:p-8">
            <!-- Portal Banner -->
            <div class="bg-gradient-to-r from-[var(--axxess-blue)] to-[var(--axxess-blue-light)] rounded-2xl p-6 mb-8 text-white shadow-lg">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-4">
                        <div class="w-14 h-14 bg-white/20 rounded-2xl flex items-center justify-center backdrop-blur-sm">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z" />
                            </svg>
                        </div>
                        <div>
                            <p class="text-white/60 text-xs uppercase tracking-wider">Dashboard</p>
                            <h2 class="text-xl font-bold">ISP Portal Dashboard</h2>
                            <p class="text-white/70 text-sm">Dashboard with Lead, Order and Commission Summary</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-3">
                        <p class="text-white/50 text-xs" id="dashboardTimestamp"></p>
                        <button onclick="location.reload()" class="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-xl text-sm font-medium backdrop-blur-sm transition">Refresh</button>
                    </div>
                </div>
            </div>

            <!-- Lead & Order Summary (Vuma-style grouped cards) -->
            <div class="mb-2">
                <h3 class="text-sm font-bold text-gray-500 uppercase tracking-wider mb-4 flex items-center gap-2">
                    <div class="w-1 h-4 bg-blue-500 rounded-full"></div>
                    Lead & Order Summary
                </h3>
            </div>
            <div class="grid grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-4 mb-8">
                <div class="card p-5 text-center hover:shadow-lg transition-all group cursor-pointer" onclick="showSection('leads')">
                    <p class="text-xs text-gray-400 font-medium mb-2 group-hover:text-blue-500 transition">Total Leads</p>
                    <p class="text-4xl font-bold text-blue-600 mb-1" id="totalLeads">0</p>
                    <p class="text-xs text-blue-400 hover:underline">View Report</p>
                </div>
                <div class="card p-5 text-center hover:shadow-lg transition-all group cursor-pointer" onclick="showSection('orders')">
                    <p class="text-xs text-gray-400 font-medium mb-2 group-hover:text-emerald-500 transition">Total Orders</p>
                    <p class="text-4xl font-bold text-emerald-600 mb-1" id="totalOrders">0</p>
                    <p class="text-xs text-emerald-400 hover:underline">View Report</p>
                </div>
                <div class="card p-5 text-center hover:shadow-lg transition-all group cursor-pointer" onclick="showSection('agents')">
                    <p class="text-xs text-gray-400 font-medium mb-2 group-hover:text-purple-500 transition">Active Agents</p>
                    <p class="text-4xl font-bold text-purple-600 mb-1" id="totalAgents">0</p>
                    <p class="text-xs text-purple-400 hover:underline">View Report</p>
                </div>
                <div class="card p-5 text-center hover:shadow-lg transition-all group cursor-pointer" onclick="showSection('dealers')">
                    <p class="text-xs text-gray-400 font-medium mb-2 group-hover:text-orange-500 transition">Dealers</p>
                    <p class="text-4xl font-bold text-orange-600 mb-1" id="totalDealers">0</p>
                    <p class="text-xs text-orange-400 hover:underline">View Report</p>
                </div>
                <div class="card p-5 text-center hover:shadow-lg transition-all">
                    <p class="text-xs text-gray-400 font-medium mb-2">Conversion Rate</p>
                    <p class="text-4xl font-bold text-pink-600 mb-1" id="conversionRate">0%</p>
                    <p class="text-xs text-gray-400" id="dashTimestampSmall"></p>
                </div>
                <div class="card p-5 text-center hover:shadow-lg transition-all">
                    <p class="text-xs text-gray-400 font-medium mb-2">Total Commission</p>
                    <p class="text-4xl font-bold text-cyan-600 mb-1" id="totalCommission">R0</p>
                    <p class="text-xs text-gray-400" id="dashTimestampSmall2"></p>
                </div>
            </div>

            <!-- Revenue & Commission Summary -->
            <div class="mb-2">
                <h3 class="text-sm font-bold text-gray-500 uppercase tracking-wider mb-4 flex items-center gap-2">
                    <div class="w-1 h-4 bg-emerald-500 rounded-full"></div>
                    Revenue & Commission Summary
                </h3>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                <div class="card p-5 text-center hover:shadow-lg transition-all">
                    <p class="text-xs text-gray-400 font-medium mb-2">Confirmed Revenue</p>
                    <p class="text-3xl font-bold text-emerald-600 mb-1" id="confirmedRevenue">R0</p>
                    <p class="text-xs text-emerald-400"><span id="confirmedCount">0</span> leads confirmed</p>
                </div>
                <div class="card p-5 text-center hover:shadow-lg transition-all">
                    <p class="text-xs text-gray-400 font-medium mb-2">Pending Revenue</p>
                    <p class="text-3xl font-bold text-amber-600 mb-1" id="pendingRevenue">R0</p>
                    <p class="text-xs text-amber-400"><span id="pendingCount">0</span> leads pending</p>
                </div>
                <div class="card p-5 text-center hover:shadow-lg transition-all">
                    <p class="text-xs text-gray-400 font-medium mb-2">Rejected / Lost</p>
                    <p class="text-3xl font-bold text-red-500 mb-1" id="rejectedRevenue">R0</p>
                    <p class="text-xs text-red-400"><span id="rejectedCount">0</span> leads rejected</p>
                </div>
            </div>

            <!-- Order Status Summary (Vuma-style) -->
            <div class="mb-2">
                <h3 class="text-sm font-bold text-gray-500 uppercase tracking-wider mb-4 flex items-center gap-2">
                    <div class="w-1 h-4 bg-purple-500 rounded-full"></div>
                    Order Status Summary
                </h3>
            </div>
            <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
                <div class="card p-5 text-center hover:shadow-lg transition-all cursor-pointer" onclick="showSection('orders'); setTimeout(()=>{document.getElementById('orderStatusFilter').value='pending'; filterOrders();}, 100)">
                    <p class="text-xs text-gray-400 font-medium mb-2">Pending Orders</p>
                    <p class="text-4xl font-bold text-amber-500 mb-1" id="dashPendingOrders">0</p>
                    <p class="text-xs text-amber-400 hover:underline">View Report (Pending)</p>
                </div>
                <div class="card p-5 text-center hover:shadow-lg transition-all cursor-pointer" onclick="showSection('orders'); setTimeout(()=>{document.getElementById('orderStatusFilter').value='processing'; filterOrders();}, 100)">
                    <p class="text-xs text-gray-400 font-medium mb-2">Processing Orders</p>
                    <p class="text-4xl font-bold text-blue-500 mb-1" id="dashProcessingOrders">0</p>
                    <p class="text-xs text-blue-400 hover:underline">View Report (Processing)</p>
                </div>
                <div class="card p-5 text-center hover:shadow-lg transition-all cursor-pointer" onclick="showSection('orders'); setTimeout(()=>{document.getElementById('orderStatusFilter').value='completed'; filterOrders();}, 100)">
                    <p class="text-xs text-gray-400 font-medium mb-2">Completed Orders</p>
                    <p class="text-4xl font-bold text-emerald-500 mb-1" id="dashCompletedOrders">0</p>
                    <p class="text-xs text-emerald-400 hover:underline">View Report (Completed)</p>
                </div>
                <div class="card p-5 text-center hover:shadow-lg transition-all cursor-pointer" onclick="showSection('orders'); setTimeout(()=>{document.getElementById('orderStatusFilter').value='cancelled'; filterOrders();}, 100)">
                    <p class="text-xs text-gray-400 font-medium mb-2">Cancelled Orders</p>
                    <p class="text-4xl font-bold text-red-500 mb-1" id="dashCancelledOrders">0</p>
                    <p class="text-xs text-red-400 hover:underline">View Report (Cancelled)</p>
                </div>
            </div>

            <!-- Lead Pipeline Summary (Vuma-style) -->
            <div class="mb-2">
                <h3 class="text-sm font-bold text-gray-500 uppercase tracking-wider mb-4 flex items-center gap-2">
                    <div class="w-1 h-4 bg-pink-500 rounded-full"></div>
                    Lead Pipeline Summary
                </h3>
            </div>
            <div class="grid grid-cols-2 lg:grid-cols-5 gap-4 mb-8">
                <div class="card p-5 text-center hover:shadow-lg transition-all cursor-pointer" onclick="showSection('leads'); setTimeout(()=>{document.getElementById('leadStatusFilter').value='new'; filterLeads();}, 100)">
                    <p class="text-xs text-gray-400 font-medium mb-2">New Leads</p>
                    <p class="text-4xl font-bold text-blue-500 mb-1" id="dashNewLeads">0</p>
                    <p class="text-xs text-blue-400 hover:underline">View Report (New)</p>
                </div>
                <div class="card p-5 text-center hover:shadow-lg transition-all cursor-pointer" onclick="showSection('leads'); setTimeout(()=>{document.getElementById('leadStatusFilter').value='contacted'; filterLeads();}, 100)">
                    <p class="text-xs text-gray-400 font-medium mb-2">Contacted</p>
                    <p class="text-4xl font-bold text-indigo-500 mb-1" id="dashContactedLeads">0</p>
                    <p class="text-xs text-indigo-400 hover:underline">View Report (Contacted)</p>
                </div>
                <div class="card p-5 text-center hover:shadow-lg transition-all cursor-pointer" onclick="showSection('leads'); setTimeout(()=>{document.getElementById('leadStatusFilter').value='qualified'; filterLeads();}, 100)">
                    <p class="text-xs text-gray-400 font-medium mb-2">Qualified</p>
                    <p class="text-4xl font-bold text-emerald-500 mb-1" id="dashQualifiedLeads">0</p>
                    <p class="text-xs text-emerald-400 hover:underline">View Report (Qualified)</p>
                </div>
                <div class="card p-5 text-center hover:shadow-lg transition-all cursor-pointer" onclick="showSection('leads'); setTimeout(()=>{document.getElementById('leadStatusFilter').value='converted'; filterLeads();}, 100)">
                    <p class="text-xs text-gray-400 font-medium mb-2">Converted</p>
                    <p class="text-4xl font-bold text-green-600 mb-1" id="dashConvertedLeads">0</p>
                    <p class="text-xs text-green-400 hover:underline">View Report (Converted)</p>
                </div>
                <div class="card p-5 text-center hover:shadow-lg transition-all cursor-pointer" onclick="showSection('leads'); setTimeout(()=>{document.getElementById('leadStatusFilter').value='lost'; filterLeads();}, 100)">
                    <p class="text-xs text-gray-400 font-medium mb-2">Lost</p>
                    <p class="text-4xl font-bold text-gray-500 mb-1" id="dashLostLeads">0</p>
                    <p class="text-xs text-gray-400 hover:underline">View Report (Lost)</p>
                </div>
            </div>

            <!-- Bottom Section - Lead Status, Top Agents, Recent Activity -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                <!-- Lead Status Breakdown -->
                <div class="card p-6">
                    <h3 class="text-sm font-bold text-gray-500 uppercase tracking-wider mb-4 flex items-center gap-2">
                        <div class="w-1 h-4 bg-blue-500 rounded-full"></div>
                        Lead Status Breakdown
                    </h3>
                    <div class="space-y-4" id="leadStatusBreakdown">
                        <!-- Populated by JS -->
                    </div>
                </div>

                <!-- Top Performing Agents -->
                <div class="card p-6">
                    <h3 class="text-sm font-bold text-gray-500 uppercase tracking-wider mb-4 flex items-center gap-2">
                        <div class="w-1 h-4 bg-purple-500 rounded-full"></div>
                        Top Performing Agents
                    </h3>
                    <div class="space-y-3" id="topAgents">
                        <!-- Populated by JS -->
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="card p-6">
                    <h3 class="text-sm font-bold text-gray-500 uppercase tracking-wider mb-4 flex items-center gap-2">
                        <div class="w-1 h-4 bg-emerald-500 rounded-full"></div>
                        Recent Activity
                    </h3>
                    <div class="space-y-3 max-h-64 overflow-y-auto" id="recentActivity">
                        <!-- Populated by JS -->
                    </div>
                </div>
            </div>

            <!-- Charts Row -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                <div class="card p-6">
                    <h3 class="text-sm font-bold text-gray-500 uppercase tracking-wider mb-4">Orders Overview</h3>
                    <canvas id="ordersChart" height="200"></canvas>
                </div>
                <div class="card p-6">
                    <h3 class="text-sm font-bold text-gray-500 uppercase tracking-wider mb-4">Lead Sources</h3>
                    <canvas id="leadsChart" height="200"></canvas>
                </div>
            </div>

            <!-- Recent Orders Table -->
            <div class="card p-6">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-sm font-bold text-gray-500 uppercase tracking-wider">Recent Orders</h3>
                    <a href="#orders" onclick="showSection('orders')" class="text-blue-500 hover:text-blue-600 text-sm font-medium">View All &rarr;</a>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead>
                            <tr class="text-left text-gray-500 text-xs border-b">
                                <th class="pb-2 font-medium">Client</th>
                                <th class="pb-2 font-medium">Package</th>
                                <th class="pb-2 font-medium">Agent</th>
                                <th class="pb-2 font-medium">Status</th>
                                <th class="pb-2 font-medium">Date</th>
                                <th class="pb-2 font-medium">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="recentOrdersTable">
                            <tr class="table-row border-b">
                                <td class="py-2" colspan="6">
                                    <p class="text-gray-500 text-center">Loading...</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Leads Section - Vuma-Style -->
        <section id="section-leads" class="p-8 hidden">
            <!-- Leads Banner -->
            <div class="bg-gradient-to-r from-blue-600 to-blue-700 rounded-2xl p-5 mb-6 text-white shadow-lg">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-4">
                        <div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" /></svg>
                        </div>
                        <div>
                            <p class="text-white/60 text-xs uppercase tracking-wider">Leads</p>
                            <h2 class="text-lg font-bold">Lead Management</h2>
                            <p class="text-white/70 text-sm" id="leadsSubtitle">Manage and track all incoming leads</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-2">
                        <button onclick="openModal('openserveEmailModal')" class="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-xl text-sm font-medium backdrop-blur-sm transition flex items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" /></svg>
                            Import Email
                        </button>
                        <button onclick="openModal('addLeadModal')" class="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-xl text-sm font-medium backdrop-blur-sm transition flex items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" /></svg>
                            Add Lead
                        </button>
                    </div>
                </div>
            </div>

            <!-- Lead Pipeline Cards -->
            <div class="mb-2">
                <h3 class="text-sm font-bold text-gray-500 uppercase tracking-wider mb-3 flex items-center gap-2">
                    <div class="w-1 h-4 bg-blue-500 rounded-full"></div>
                    Lead Pipeline
                </h3>
            </div>
            <div class="grid grid-cols-2 lg:grid-cols-6 gap-4 mb-6">
                <div class="card p-4 text-center cursor-pointer hover:shadow-lg transition-all" onclick="document.getElementById('leadStatusFilter').value=''; filterLeads();">
                    <p class="text-xs text-gray-400 font-medium mb-1">All Leads</p>
                    <p class="text-3xl font-bold text-gray-700" id="leadsAllCount">0</p>
                </div>
                <div class="card p-4 text-center cursor-pointer hover:shadow-lg transition-all" onclick="document.getElementById('leadStatusFilter').value='new'; filterLeads();">
                    <p class="text-xs text-gray-400 font-medium mb-1">New</p>
                    <p class="text-3xl font-bold text-blue-500" id="leadsNewCount">0</p>
                </div>
                <div class="card p-4 text-center cursor-pointer hover:shadow-lg transition-all" onclick="document.getElementById('leadStatusFilter').value='contacted'; filterLeads();">
                    <p class="text-xs text-gray-400 font-medium mb-1">Contacted</p>
                    <p class="text-3xl font-bold text-indigo-500" id="leadsContactedCount">0</p>
                </div>
                <div class="card p-4 text-center cursor-pointer hover:shadow-lg transition-all" onclick="document.getElementById('leadStatusFilter').value='qualified'; filterLeads();">
                    <p class="text-xs text-gray-400 font-medium mb-1">Qualified</p>
                    <p class="text-3xl font-bold text-emerald-500" id="leadsQualifiedCount">0</p>
                </div>
                <div class="card p-4 text-center cursor-pointer hover:shadow-lg transition-all" onclick="document.getElementById('leadStatusFilter').value='converted'; filterLeads();">
                    <p class="text-xs text-gray-400 font-medium mb-1">Converted</p>
                    <p class="text-3xl font-bold text-green-600" id="leadsConvertedCount">0</p>
                </div>
                <div class="card p-4 text-center cursor-pointer hover:shadow-lg transition-all" onclick="document.getElementById('leadStatusFilter').value='lost'; filterLeads();">
                    <p class="text-xs text-gray-400 font-medium mb-1">Lost</p>
                    <p class="text-3xl font-bold text-gray-500" id="leadsLostCount">0</p>
                </div>
            </div>

            <!-- Filters & Search -->
            <div class="flex flex-wrap items-center gap-3 mb-6">
                <div class="relative flex-1 min-w-[200px] max-w-sm">
                    <input type="text" id="leadSearchFilter" placeholder="Search name, email, phone, lead ID..." 
                        class="w-full pl-10 pr-4 py-2 border rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500/20"
                        oninput="filterLeads()">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400 absolute left-3 top-1/2 -translate-y-1/2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" /></svg>
                </div>
                <select id="leadStatusFilter" class="border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500/20" onchange="filterLeads()">
                    <option value="">All Status</option>
                    <option value="new">New</option>
                    <option value="contacted">Contacted</option>
                    <option value="qualified">Qualified</option>
                    <option value="converted">Converted</option>
                    <option value="lost">Lost</option>
                </select>
                <select id="leadAgentFilter" class="border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500/20" onchange="filterLeads()">
                    <option value="">All Agents</option>
                </select>
                <select id="leadDealerFilter" class="border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500/20" onchange="filterLeads()">
                    <option value="">All Dealers</option>
                </select>
                <button onclick="clearLeadFilters()" class="text-gray-500 hover:text-gray-700 px-3 py-2 text-sm border rounded-xl hover:bg-gray-50">Clear</button>
                <span id="leadFilterCount" class="text-sm text-gray-500 ml-auto"></span>
            </div>

            <div class="card">
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr class="text-left text-gray-500 text-xs uppercase tracking-wider">
                                <th class="py-3 px-4 font-medium">Client Name</th>
                                <th class="py-3 px-4 font-medium">Contact</th>
                                <th class="py-3 px-4 font-medium">Address</th>
                                <th class="py-3 px-4 font-medium">Package Interest</th>
                                <th class="py-3 px-4 font-medium">Agent</th>
                                <th class="py-3 px-4 font-medium">Dealer</th>
                                <th class="py-3 px-4 font-medium">Status</th>
                                <th class="py-3 px-4 font-medium">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="leadsTable">
                            <tr class="table-row border-b">
                                <td class="py-4 px-4" colspan="8">
                                    <p class="text-gray-500 text-center">Loading leads...</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Orders Section - Vuma-Style -->
        <section id="section-orders" class="p-8 hidden">
            <!-- Orders Banner -->
            <div class="bg-gradient-to-r from-emerald-600 to-emerald-700 rounded-2xl p-5 mb-6 text-white shadow-lg">
                <div class="flex items-center gap-4">
                    <div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" /></svg>
                    </div>
                    <div>
                        <p class="text-white/60 text-xs uppercase tracking-wider">Orders</p>
                        <h2 class="text-lg font-bold">Order Management</h2>
                        <p class="text-white/70 text-sm">Track and manage all customer orders</p>
                    </div>
                </div>
            </div>

            <!-- Order Status Summary Cards -->
            <div class="mb-2">
                <h3 class="text-sm font-bold text-gray-500 uppercase tracking-wider mb-3 flex items-center gap-2">
                    <div class="w-1 h-4 bg-emerald-500 rounded-full"></div>
                    Order Status Overview
                </h3>
            </div>
            <div class="grid grid-cols-2 lg:grid-cols-5 gap-4 mb-6">
                <div class="card p-4 text-center cursor-pointer hover:shadow-lg transition-all" onclick="document.getElementById('orderStatusFilter').value=''; filterOrders();">
                    <p class="text-xs text-gray-400 font-medium mb-1">All Orders</p>
                    <p class="text-3xl font-bold text-gray-700" id="ordersAllCount">0</p>
                </div>
                <div class="card p-4 text-center cursor-pointer hover:shadow-lg transition-all" onclick="document.getElementById('orderStatusFilter').value='pending'; filterOrders();">
                    <p class="text-xs text-gray-400 font-medium mb-1">Pending</p>
                    <p class="text-3xl font-bold text-amber-500" id="ordersPendingCount">0</p>
                </div>
                <div class="card p-4 text-center cursor-pointer hover:shadow-lg transition-all" onclick="document.getElementById('orderStatusFilter').value='processing'; filterOrders();">
                    <p class="text-xs text-gray-400 font-medium mb-1">Processing</p>
                    <p class="text-3xl font-bold text-blue-500" id="ordersProcessingCount">0</p>
                </div>
                <div class="card p-4 text-center cursor-pointer hover:shadow-lg transition-all" onclick="document.getElementById('orderStatusFilter').value='completed'; filterOrders();">
                    <p class="text-xs text-gray-400 font-medium mb-1">Completed</p>
                    <p class="text-3xl font-bold text-emerald-500" id="ordersCompletedCount">0</p>
                </div>
                <div class="card p-4 text-center cursor-pointer hover:shadow-lg transition-all" onclick="document.getElementById('orderStatusFilter').value='cancelled'; filterOrders();">
                    <p class="text-xs text-gray-400 font-medium mb-1">Cancelled</p>
                    <p class="text-3xl font-bold text-red-500" id="ordersCancelledCount">0</p>
                </div>
            </div>

            <!-- Filters & Search -->
            <div class="flex flex-wrap items-center gap-3 mb-6">
                <div class="relative flex-1 min-w-[200px] max-w-sm">
                    <input type="text" id="orderSearchFilter" placeholder="Search orders..." class="w-full pl-10 pr-4 py-2 border rounded-xl focus:outline-none focus:ring-2 focus:ring-emerald-500/20" oninput="filterOrders()">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400 absolute left-3 top-1/2 -translate-y-1/2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" /></svg>
                </div>
                <select id="orderStatusFilter" class="border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-emerald-500/20" onchange="filterOrders()">
                    <option value="">All Status</option>
                    <option value="pending">Pending</option>
                    <option value="processing">Processing</option>
                    <option value="scheduled">Scheduled</option>
                    <option value="completed">Completed</option>
                    <option value="cancelled">Cancelled</option>
                </select>
                <select id="orderAgentFilter" class="border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-emerald-500/20" onchange="filterOrders()">
                    <option value="">All Agents</option>
                </select>
                <span id="orderFilterCount" class="text-sm text-gray-500 ml-auto"></span>
            </div>

            <div class="card">
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr class="text-left text-gray-500 text-xs uppercase tracking-wider">
                                <th class="py-3 px-4 font-medium">Order ID</th>
                                <th class="py-3 px-4 font-medium">Client</th>
                                <th class="py-3 px-4 font-medium">Package</th>
                                <th class="py-3 px-4 font-medium">Agent</th>
                                <th class="py-3 px-4 font-medium">Status</th>
                                <th class="py-3 px-4 font-medium">Created</th>
                                <th class="py-3 px-4 font-medium">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="ordersTable">
                            <tr class="table-row border-b">
                                <td class="py-4 px-4" colspan="7">
                                    <p class="text-gray-500 text-center">Loading orders...</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Payments Section - Vuma-Style -->
        <section id="section-payments" class="p-8 hidden">
            <!-- Payments Banner -->
            <div class="bg-gradient-to-r from-rose-600 to-pink-600 rounded-2xl p-5 mb-6 text-white shadow-lg">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-4">
                        <div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z" /></svg>
                        </div>
                        <div>
                            <p class="text-white/60 text-xs uppercase tracking-wider">Payments</p>
                            <h2 class="text-lg font-bold">Payment Tracking</h2>
                            <p class="text-white/70 text-sm">Monitor client payments, flag overdue accounts, send reminders</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-2">
                        <button onclick="exportPaymentReport()" class="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-xl text-sm font-medium backdrop-blur-sm transition flex items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>
                            Export Report
                        </button>
                    </div>
                </div>
            </div>

            <!-- Payment Summary Cards -->
            <div class="mb-2">
                <h3 class="text-sm font-bold text-gray-500 uppercase tracking-wider mb-3 flex items-center gap-2">
                    <div class="w-1 h-4 bg-rose-500 rounded-full"></div>
                    Payment Overview
                </h3>
            </div>
            <div class="grid grid-cols-2 lg:grid-cols-5 gap-4 mb-6">
                <div class="card p-4 text-center cursor-pointer hover:shadow-lg transition-all" onclick="filterPayments('')">
                    <p class="text-xs text-gray-400 font-medium mb-1">Total Orders</p>
                    <p class="text-3xl font-bold text-gray-700" id="payTotalOrders">0</p>
                    <p class="text-xs text-gray-400 mt-1" id="payTotalAmount">R0</p>
                </div>
                <div class="card p-4 text-center cursor-pointer hover:shadow-lg transition-all border-l-4 border-l-emerald-500" onclick="filterPayments('paid')">
                    <p class="text-xs text-gray-400 font-medium mb-1">Paid</p>
                    <p class="text-3xl font-bold text-emerald-600" id="payPaidCount">0</p>
                    <p class="text-xs text-emerald-500 mt-1" id="payPaidAmount">R0</p>
                </div>
                <div class="card p-4 text-center cursor-pointer hover:shadow-lg transition-all border-l-4 border-l-amber-500" onclick="filterPayments('unpaid')">
                    <p class="text-xs text-gray-400 font-medium mb-1">Unpaid</p>
                    <p class="text-3xl font-bold text-amber-600" id="payUnpaidCount">0</p>
                    <p class="text-xs text-amber-500 mt-1" id="payUnpaidAmount">R0</p>
                </div>
                <div class="card p-4 text-center cursor-pointer hover:shadow-lg transition-all border-l-4 border-l-red-500" onclick="filterPayments('overdue')">
                    <p class="text-xs text-gray-400 font-medium mb-1">Overdue</p>
                    <p class="text-3xl font-bold text-red-600" id="payOverdueCount">0</p>
                    <p class="text-xs text-red-500 mt-1" id="payOverdueAmount">R0</p>
                </div>
                <div class="card p-4 text-center cursor-pointer hover:shadow-lg transition-all border-l-4 border-l-blue-500" onclick="filterPayments('partial')">
                    <p class="text-xs text-gray-400 font-medium mb-1">Partial</p>
                    <p class="text-3xl font-bold text-blue-600" id="payPartialCount">0</p>
                    <p class="text-xs text-blue-500 mt-1" id="payPartialAmount">R0</p>
                </div>
            </div>

            <!-- Aging Report -->
            <div class="mb-2">
                <h3 class="text-sm font-bold text-gray-500 uppercase tracking-wider mb-3 flex items-center gap-2">
                    <div class="w-1 h-4 bg-amber-500 rounded-full"></div>
                    Aging Report
                </h3>
            </div>
            <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                <div class="card p-4 text-center">
                    <p class="text-xs text-gray-400 font-medium mb-1">0-7 Days</p>
                    <p class="text-2xl font-bold text-green-600" id="aging7">0</p>
                    <p class="text-xs text-gray-400">Current</p>
                </div>
                <div class="card p-4 text-center">
                    <p class="text-xs text-gray-400 font-medium mb-1">8-14 Days</p>
                    <p class="text-2xl font-bold text-amber-500" id="aging14">0</p>
                    <p class="text-xs text-gray-400">Due Soon</p>
                </div>
                <div class="card p-4 text-center">
                    <p class="text-xs text-gray-400 font-medium mb-1">15-30 Days</p>
                    <p class="text-2xl font-bold text-orange-500" id="aging30">0</p>
                    <p class="text-xs text-gray-400">Overdue</p>
                </div>
                <div class="card p-4 text-center">
                    <p class="text-xs text-gray-400 font-medium mb-1">30+ Days</p>
                    <p class="text-2xl font-bold text-red-600" id="aging30plus">0</p>
                    <p class="text-xs text-gray-400">Critical</p>
                </div>
            </div>

            <!-- Filters & Search -->
            <div class="flex flex-wrap items-center gap-3 mb-6">
                <div class="relative flex-1 min-w-[200px] max-w-sm">
                    <input type="text" id="paymentSearchFilter" placeholder="Search client, order #, account..." class="w-full pl-10 pr-4 py-2 border rounded-xl focus:outline-none focus:ring-2 focus:ring-rose-500/20" oninput="filterPayments()">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400 absolute left-3 top-1/2 -translate-y-1/2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" /></svg>
                </div>
                <select id="paymentStatusFilter" class="border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-rose-500/20" onchange="filterPayments()">
                    <option value="">All Payment Status</option>
                    <option value="paid">Paid</option>
                    <option value="unpaid">Unpaid</option>
                    <option value="overdue">Overdue</option>
                    <option value="partial">Partial</option>
                </select>
                <button onclick="sendBulkReminders()" class="bg-gradient-to-r from-rose-500 to-pink-500 text-white px-4 py-2 rounded-xl text-sm font-medium hover:shadow-md transition-all flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" /></svg>
                    Send Reminders to Overdue
                </button>
                <span id="paymentFilterCount" class="text-sm text-gray-500 ml-auto"></span>
            </div>

            <!-- Payments Table -->
            <div class="card">
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr class="text-left text-gray-500 text-xs uppercase tracking-wider">
                                <th class="py-3 px-4 font-medium">Client</th>
                                <th class="py-3 px-4 font-medium">Order #</th>
                                <th class="py-3 px-4 font-medium">Package</th>
                                <th class="py-3 px-4 font-medium">Amount</th>
                                <th class="py-3 px-4 font-medium">Payment Status</th>
                                <th class="py-3 px-4 font-medium">Age</th>
                                <th class="py-3 px-4 font-medium">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="paymentsTable">
                            <tr class="table-row border-b">
                                <td class="py-4 px-4" colspan="7">
                                    <p class="text-gray-500 text-center">Loading payment data...</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Payment Status Modal -->
        <div class="modal-overlay" id="paymentStatusModal">
            <div class="modal-container max-w-lg">
                <div class="modal-header">
                    <h3 class="font-bold text-gray-800">Update Payment Status</h3>
                    <button onclick="closeModal('paymentStatusModal')" class="text-gray-400 hover:text-gray-600">&times;</button>
                </div>
                <div class="p-6 space-y-4">
                    <div>
                        <p class="text-sm text-gray-500 mb-1">Client</p>
                        <p class="font-medium text-gray-800" id="payModalClient">-</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500 mb-1">Order</p>
                        <p class="font-medium text-gray-800" id="payModalOrder">-</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Payment Status</label>
                        <select id="payModalStatus" class="w-full border rounded-xl px-4 py-2">
                            <option value="unpaid">Unpaid</option>
                            <option value="paid">Paid</option>
                            <option value="partial">Partial Payment</option>
                            <option value="overdue">Overdue</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Payment Amount (R)</label>
                        <input type="number" id="payModalAmount" class="w-full border rounded-xl px-4 py-2" placeholder="0.00">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Payment Method</label>
                        <select id="payModalMethod" class="w-full border rounded-xl px-4 py-2">
                            <option value="">Select method</option>
                            <option value="eft">EFT / Bank Transfer</option>
                            <option value="debit_order">Debit Order</option>
                            <option value="cash">Cash</option>
                            <option value="card">Card Payment</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Payment Date</label>
                        <input type="date" id="payModalDate" class="w-full border rounded-xl px-4 py-2">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Notes</label>
                        <textarea id="payModalNotes" class="w-full border rounded-xl px-4 py-2" rows="2" placeholder="Payment reference, notes..."></textarea>
                    </div>
                    <button onclick="savePaymentStatus()" class="w-full bg-gradient-to-r from-rose-500 to-pink-500 text-white py-3 rounded-xl font-medium hover:shadow-lg transition-all">
                        Save Payment Status
                    </button>
                </div>
            </div>
        </div>

        <!-- Agents Section -->
        <section id="section-agents" class="p-8 hidden">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-lg font-semibold text-gray-800">Manage Agents</h3>
                <button onclick="openModal('addAgentModal')" class="btn-primary text-white px-6 py-2 rounded-xl font-medium flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                    </svg>
                    Add Agent
                </button>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="agentsGrid">
                <div class="card p-6 text-center">
                    <p class="text-gray-500">Loading agents...</p>
                </div>
            </div>
        </section>

        <!-- Packages Section -->
        <section id="section-packages" class="p-8 hidden">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-lg font-semibold text-gray-800">Openserve Packages</h3>
                <button onclick="openModal('addPackageModal')" class="btn-primary text-white px-6 py-2 rounded-xl font-medium flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                    </svg>
                    Add Package
                </button>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="packagesGrid">
                <div class="card p-6 text-center">
                    <p class="text-gray-500">Loading packages...</p>
                </div>
            </div>
        </section>

        <!-- Shipping Section -->
        <section id="section-shipping" class="p-8 hidden">
            <div class="mb-6">
                <h3 class="text-lg font-semibold text-gray-800">Free Router Deliveries</h3>
                <p class="text-gray-500 text-sm mt-1">Track and manage free router deliveries for non-WebConnect and non-prepaid packages</p>
            </div>

            <div class="card p-6">
                <div class="flex items-center justify-between mb-4">
                    <div>
                        <h4 class="font-semibold text-gray-700">Pending Deliveries</h4>
                        <p class="text-sm text-gray-500">Orders requiring free router delivery</p>
                    </div>
                    <button onclick="markAllDeliveriesRequested()" class="bg-emerald-600 text-white px-4 py-2 rounded-lg text-sm hover:bg-emerald-700">
                        Mark All as Requested
                    </button>
                </div>

                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50 border-b">
                            <tr>
                                <th class="text-left py-3 px-4 text-sm font-semibold text-gray-700">
                                    <input type="checkbox" id="selectAllDeliveries" onchange="toggleAllDeliveries(this)" class="rounded">
                                </th>
                                <th class="text-left py-3 px-4 text-sm font-semibold text-gray-700">Account Number</th>
                                <th class="text-left py-3 px-4 text-sm font-semibold text-gray-700">Client Name</th>
                                <th class="text-left py-3 px-4 text-sm font-semibold text-gray-700">Package</th>
                                <th class="text-left py-3 px-4 text-sm font-semibold text-gray-700">Address</th>
                                <th class="text-left py-3 px-4 text-sm font-semibold text-gray-700">Order Date</th>
                                <th class="text-left py-3 px-4 text-sm font-semibold text-gray-700">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="shippingTable">
                            <tr>
                                <td colspan="7" class="py-8 text-center text-gray-500">Loading deliveries...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="card p-6 mt-6">
                <h4 class="font-semibold text-gray-700 mb-4">Completed Deliveries</h4>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50 border-b">
                            <tr>
                                <th class="text-left py-3 px-4 text-sm font-semibold text-gray-700">Account Number</th>
                                <th class="text-left py-3 px-4 text-sm font-semibold text-gray-700">Client Name</th>
                                <th class="text-left py-3 px-4 text-sm font-semibold text-gray-700">Package</th>
                                <th class="text-left py-3 px-4 text-sm font-semibold text-gray-700">Requested Date</th>
                                <th class="text-left py-3 px-4 text-sm font-semibold text-gray-700">Requested By</th>
                            </tr>
                        </thead>
                        <tbody id="completedShippingTable">
                            <tr>
                                <td colspan="5" class="py-8 text-center text-gray-500">No completed deliveries</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Preorders Section -->
        <section id="section-preorders" class="p-8 hidden">
            <div class="flex items-center justify-between mb-6">
                <div>
                    <h2 class="text-xl font-bold text-gray-800">Preorders</h2>
                    <p class="text-gray-500 text-sm">Manage and track preorder leads</p>
                </div>
                <div class="flex gap-2">
                    <select id="preorderStatusFilter" onchange="filterPreorders()" class="border rounded-xl px-4 py-2 focus:outline-none">
                        <option value="">All Statuses</option>
                        <option value="new">New</option>
                        <option value="contacted">Contacted</option>
                        <option value="qualified">Qualified</option>
                        <option value="converted">Converted</option>
                    </select>
                    <button onclick="exportPreorders()" class="bg-blue-600 text-white px-4 py-2 rounded-xl hover:bg-blue-700">
                        Export Preorders
                    </button>
                </div>
            </div>

            <div class="card p-6">
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50 border-b">
                            <tr>
                                <th class="text-left py-3 px-4 text-sm font-semibold text-gray-700">Client</th>
                                <th class="text-left py-3 px-4 text-sm font-semibold text-gray-700">Contact</th>
                                <th class="text-left py-3 px-4 text-sm font-semibold text-gray-700">Package</th>
                                <th class="text-left py-3 px-4 text-sm font-semibold text-gray-700">Agent</th>
                                <th class="text-left py-3 px-4 text-sm font-semibold text-gray-700">Dealer</th>
                                <th class="text-left py-3 px-4 text-sm font-semibold text-gray-700">Status</th>
                                <th class="text-left py-3 px-4 text-sm font-semibold text-gray-700">Created</th>
                                <th class="text-left py-3 px-4 text-sm font-semibold text-gray-700">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="preordersTable">
                            <tr>
                                <td colspan="8" class="py-8 text-center text-gray-500">No preorders found</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Reports Section -->
        <section id="section-reports" class="p-8 hidden">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="card p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Agent Performance</h3>
                    <canvas id="agentPerformanceChart" height="250"></canvas>
                </div>
                <div class="card p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Monthly Conversions</h3>
                    <canvas id="monthlyConversionsChart" height="250"></canvas>
                </div>
            </div>
        </section>

        <!-- Returned Items Section -->
        <section id="section-returned" class="p-8 hidden">
            <div class="flex items-center justify-between mb-6">
                <div>
                    <h2 class="text-xl font-bold text-gray-800">Returned Items</h2>
                    <p class="text-gray-500 text-sm">Orders returned for follow-up or correction</p>
                </div>
                <div class="flex gap-2">
                    <select id="returnedStatusFilter" onchange="filterReturnedItems()" class="border rounded-xl px-4 py-2 focus:outline-none">
                        <option value="">All Status</option>
                        <option value="pending">Pending Review</option>
                        <option value="acknowledged">Acknowledged</option>
                        <option value="resolved">Resolved</option>
                        <option value="rejected">Rejected</option>
                    </select>
                    <button onclick="exportReturnedItems()" class="btn-primary text-white px-4 py-2 rounded-xl text-sm">Export</button>
                </div>
            </div>

            <!-- Stats Cards -->
            <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                <div class="card p-4">
                    <p class="text-gray-500 text-sm">Total Returned</p>
                    <p class="text-2xl font-bold text-gray-800" id="totalReturned">0</p>
                </div>
                <div class="card p-4">
                    <p class="text-gray-500 text-sm">Pending Review</p>
                    <p class="text-2xl font-bold text-yellow-600" id="pendingReturned">0</p>
                </div>
                <div class="card p-4">
                    <p class="text-gray-500 text-sm">Resolved</p>
                    <p class="text-2xl font-bold text-green-600" id="resolvedReturned">0</p>
                </div>
                <div class="card p-4">
                    <p class="text-gray-500 text-sm">Rejected</p>
                    <p class="text-2xl font-bold text-red-600" id="rejectedReturned">0</p>
                </div>
            </div>

            <div class="card">
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="text-left py-3 px-4 text-xs font-medium text-gray-500 uppercase">Order</th>
                                <th class="text-left py-3 px-4 text-xs font-medium text-gray-500 uppercase">Client</th>
                                <th class="text-left py-3 px-4 text-xs font-medium text-gray-500 uppercase">Returned By</th>
                                <th class="text-left py-3 px-4 text-xs font-medium text-gray-500 uppercase">Reason</th>
                                <th class="text-left py-3 px-4 text-xs font-medium text-gray-500 uppercase">Status</th>
                                <th class="text-left py-3 px-4 text-xs font-medium text-gray-500 uppercase">Date</th>
                                <th class="text-left py-3 px-4 text-xs font-medium text-gray-500 uppercase">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="returnedItemsTable"></tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Import Section -->
        <section id="section-import" class="p-4 md:p-8 hidden">
            <div class="card p-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-2">Mass Import Leads</h3>
                <p class="text-gray-500 text-sm mb-6">Upload a CSV file to import multiple leads at once. Leads will be assigned to dealers and agents as specified.</p>

                <div class="mb-6">
                    <h4 class="font-medium text-gray-700 mb-2">CSV Format Requirements:</h4>
                    <div class="bg-gray-50 rounded-xl p-4 text-sm text-gray-600 overflow-x-auto">
                        <p class="mb-2">Your CSV file should have the following columns:</p>
                        <code class="bg-gray-200 px-2 py-1 rounded text-xs whitespace-nowrap">LEAD ID, AGENT, DEALER, DEAL, SERVICE ID, ACCOUNT NUMBER, STATUS, REGION, PRIMARY CONTACT NAME, PRIMARY CONTACT NUMBER, PRIMARY CONTACT EMAIL, SECONDARY CONTACT NAME, SECONDARY CONTACT NUMBER, SECONDARY CONTACT SECONDARY, SECONDARY CONTACT EMAIL, ORDER NUMBER, ORDER STATUS, ORDER DATE, DATE CAPTURED, LAST UPDATED, CAPTURED BY, SECONDARY CONTACT</code>
                        <ul class="mt-3 space-y-1 text-gray-500 text-xs">
                            <li> <strong>LEAD ID</strong> - Unique identifier to avoid duplicates</li>
                            <li> <strong>AGENT</strong> - Agent name or email</li>
                            <li> <strong>DEALER</strong> - Dealer name</li>
                            <li> <strong>DEAL</strong> - Package/deal name</li>
                            <li> <strong>PRIMARY CONTACT NAME</strong> - Client's full name</li>
                            <li> <strong>PRIMARY CONTACT NUMBER</strong> - Client's phone</li>
                            <li> <strong>PRIMARY CONTACT EMAIL</strong> - Client's email</li>
                            <li> <strong>STATUS</strong> - Lead status (new, contacted, qualified, etc.)</li>
                            <li> <strong>REGION</strong> - Client's address/region</li>
                        </ul>
                    </div>
                </div>

                <div class="mb-6">
                    <a href="#" onclick="downloadTemplate()" class="text-emerald-600 hover:text-emerald-700 font-medium flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                        </svg>
                        Download CSV Template
                    </a>
                </div>

                <div class="border-2 border-dashed border-gray-300 rounded-xl p-8 text-center" id="dropZone">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-gray-400 mx-auto mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                    </svg>
                    <p class="text-gray-600 mb-2">Drag and drop your CSV file here, or</p>
                    <label class="btn-primary text-white px-6 py-2 rounded-xl font-medium cursor-pointer inline-block">
                        Browse Files
                        <input type="file" accept=".csv" class="hidden" id="csvFileInput" onchange="handleFileSelect(event)">
                    </label>
                </div>

                <div id="importPreview" class="mt-6 hidden">
                    <h4 class="font-medium text-gray-700 mb-4">Preview (first 5 rows):</h4>
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm" id="previewTable"></table>
                    </div>
                    <div class="mt-4 flex gap-4">
                        <button onclick="confirmImport()" class="btn-primary text-white px-6 py-2 rounded-xl font-medium">
                            Import <span id="importCount">0</span> Leads
                        </button>
                        <button onclick="cancelImport()" class="border px-6 py-2 rounded-xl hover:bg-gray-50">
                            Cancel
                        </button>
                    </div>
                </div>

                <div id="importProgress" class="mt-6 hidden">
                    <div class="flex items-center gap-4">
                        <div class="flex-1 bg-gray-200 rounded-full h-2">
                            <div id="progressBar" class="bg-emerald-500 h-2 rounded-full transition-all" style="width: 0%"></div>
                        </div>
                        <span id="progressText" class="text-sm text-gray-600">0%</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Dealers Section -->
        <section id="section-dealers" class="p-4 md:p-8 hidden">
            <div class="flex flex-col md:flex-row items-start md:items-center justify-between mb-6 gap-4">
                <h3 class="text-lg font-semibold text-gray-800">Dealer Management</h3>
                <button onclick="openModal('addDealerModal')" class="btn-primary text-white px-6 py-2 rounded-xl font-medium flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                    </svg>
                    Add Dealer
                </button>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="dealersGrid">
                <div class="card p-6 text-center">
                    <p class="text-gray-500">Loading dealers...</p>
                </div>
            </div>
        </section>

        <!-- Pending Agents Section -->
        <section id="section-pending-agents" class="p-4 md:p-8 hidden">
            <div class="mb-6">
                <h3 class="text-lg font-semibold text-gray-800">Pending Agent Approvals</h3>
                <p class="text-gray-500 text-sm">Review and approve agents imported from CSV files</p>
            </div>
            <div class="card overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr class="text-left text-gray-500 text-sm">
                                <th class="px-6 py-4 font-medium">Name</th>
                                <th class="px-6 py-4 font-medium">Email</th>
                                <th class="px-6 py-4 font-medium">Dealer</th>
                                <th class="px-6 py-4 font-medium">Date Added</th>
                                <th class="px-6 py-4 font-medium">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="pendingAgentsTable">
                            <tr class="border-t">
                                <td class="px-6 py-4" colspan="5">
                                    <p class="text-gray-500 text-center">No pending agents</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Axxess Sales Section (Full Integration from Project 4) -->
        <section id="section-axxess-sales" class="p-4 md:p-8 hidden">
            <div class="flex items-center justify-between mb-6">
                <div>
                    <h3 class="text-lg font-semibold text-gray-800">Axxess Sales Dashboard</h3>
                    <p class="text-gray-500 text-sm">Full sales management  add, track, import, export, commissions & reminders</p>
                </div>
                <button onclick="loadAxxessSalesData()" class="border px-4 py-2 rounded-xl text-sm hover:bg-gray-50 flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                    </svg>
                    Refresh
                </button>
            </div>

            <!-- Agent Selector (super_admin sees dropdown, others see their name) -->
            <div id="axAgentSelector"></div>

            <!-- Stats Cards -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                <div class="card p-5 border-l-4 border-blue-500">
                    <p class="text-3xl font-bold text-gray-800" id="axxessAgentCount">0</p>
                    <p class="text-gray-500 text-sm">Agents</p>
                </div>
                <div class="card p-5 border-l-4 border-emerald-500">
                    <p class="text-3xl font-bold text-gray-800" id="axxessTotalSales">0</p>
                    <p class="text-gray-500 text-sm">Total Sales</p>
                </div>
                <div class="card p-5 border-l-4 border-purple-500">
                    <p class="text-3xl font-bold text-gray-800" id="axxessMonthSales">0</p>
                    <p class="text-gray-500 text-sm">This Month</p>
                </div>
                <div class="card p-5 border-l-4 border-orange-500">
                    <p class="text-3xl font-bold text-gray-800" id="axxessTotalValue">R0</p>
                    <p class="text-gray-500 text-sm">Commissioned Value</p>
                </div>
            </div>

            <!-- Sub-Tabs -->
            <div class="flex flex-wrap gap-1 mb-6 bg-gray-100 rounded-xl p-1">
                <button data-ax-tab="ax-overview" class="ax-tab-btn active px-3 py-2 rounded-lg text-sm font-medium transition" onclick="axSwitchTab('ax-overview')">Overview</button>
                <button data-ax-tab="ax-add-sale" class="ax-tab-btn px-3 py-2 rounded-lg text-sm font-medium transition" onclick="axSwitchTab('ax-add-sale')">Add Sale</button>
                <button data-ax-tab="ax-current-month" class="ax-tab-btn px-3 py-2 rounded-lg text-sm font-medium transition" onclick="axSwitchTab('ax-current-month')">Current Month</button>
                <button data-ax-tab="ax-sales-history" class="ax-tab-btn px-3 py-2 rounded-lg text-sm font-medium transition" onclick="axSwitchTab('ax-sales-history')">History</button>
                <button data-ax-tab="ax-commission" class="ax-tab-btn px-3 py-2 rounded-lg text-sm font-medium transition" onclick="axSwitchTab('ax-commission')">Commission</button>
                <button data-ax-tab="ax-mass-import" class="ax-tab-btn px-3 py-2 rounded-lg text-sm font-medium transition" onclick="axSwitchTab('ax-mass-import')">Import</button>
                <button data-ax-tab="ax-export" class="ax-tab-btn px-3 py-2 rounded-lg text-sm font-medium transition" onclick="axSwitchTab('ax-export')">Export</button>
                <button data-ax-tab="ax-reminders" class="ax-tab-btn px-3 py-2 rounded-lg text-sm font-medium transition" onclick="axSwitchTab('ax-reminders')">Reminders</button>
                <button data-ax-tab="ax-free-trials" class="ax-tab-btn px-3 py-2 rounded-lg text-sm font-medium transition" onclick="axSwitchTab('ax-free-trials')">Free Trials</button>
                <button data-ax-tab="ax-status-checks" class="ax-tab-btn px-3 py-2 rounded-lg text-sm font-medium transition" onclick="axSwitchTab('ax-status-checks')">Status Checks</button>
                <button data-ax-tab="ax-permissions" class="ax-tab-btn px-3 py-2 rounded-lg text-sm font-medium transition" onclick="axSwitchTab('ax-permissions')">Permissions</button>
            </div>

            <!-- Tab Content (rendered dynamically by axxess-sales.js) -->
            <div id="axTabContent">
                <div class="card p-6 text-center text-gray-500">Loading Axxess sales data...</div>
            </div>
        </section>

        <!-- Axxess Status Update Modal -->
        <div id="axStatusModal" class="modal-overlay">
            <div class="modal-container" style="max-width:480px">
                <div class="modal-header">
                    <h3 class="text-lg font-semibold">Update Sale Status</h3>
                    <button onclick="closeModal('axStatusModal')" class="text-gray-400 hover:text-gray-600">&times;</button>
                </div>
                <div class="modal-body p-6 space-y-4">
                    <p class="text-sm text-gray-500" id="axModalSaleInfo">-</p>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">New Status</label>
                        <select id="axModalStatus" onchange="axModalUpdateReasons()" class="w-full border rounded-xl px-3 py-2">
                            <option value="Paid-Active">Paid-Active</option>
                            <option value="Pending">Pending</option>
                            <option value="Partial">Partial</option>
                            <option value="Failed">Failed</option>
                            <option value="Free Trial">Free Trial</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Status Details</label>
                        <select id="axModalReason" class="w-full border rounded-xl px-3 py-2">
                            <option value="">Select Details...</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Notes</label>
                        <textarea id="axModalNotes" class="w-full border rounded-xl px-3 py-2" rows="3"></textarea>
                    </div>
                </div>
                <div class="modal-footer flex justify-end gap-3 p-4 border-t">
                    <button onclick="closeModal('axStatusModal')" class="border px-4 py-2 rounded-xl text-sm">Cancel</button>
                    <button onclick="axUpdateSaleStatus()" class="btn-primary text-white px-4 py-2 rounded-xl text-sm">Update Status</button>
                </div>
            </div>
        </div>

        <!-- Axxess Reminder Modal -->
        <div id="axReminderModal" class="modal-overlay">
            <div class="modal-container" style="max-width:520px">
                <div class="modal-header">
                    <h3 class="text-lg font-semibold">Create Reminder</h3>
                    <button onclick="closeModal('axReminderModal')" class="text-gray-400 hover:text-gray-600">&times;</button>
                </div>
                <div class="modal-body p-6 space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Title *</label>
                        <input type="text" id="axRemTitle" class="w-full border rounded-xl px-3 py-2" placeholder="Follow up with client...">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                        <textarea id="axRemDesc" class="w-full border rounded-xl px-3 py-2" rows="2"></textarea>
                    </div>
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Date & Time *</label>
                            <input type="datetime-local" id="axRemDatetime" class="w-full border rounded-xl px-3 py-2">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Priority</label>
                            <select id="axRemPriority" class="w-full border rounded-xl px-3 py-2">
                                <option value="low">Low</option>
                                <option value="normal" selected>Normal</option>
                                <option value="high">High</option>
                                <option value="urgent">Urgent</option>
                            </select>
                        </div>
                    </div>
                    <div class="grid grid-cols-3 gap-3">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Client Name</label>
                            <input type="text" id="axRemClient" class="w-full border rounded-xl px-3 py-2">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Account #</label>
                            <input type="text" id="axRemAccount" class="w-full border rounded-xl px-3 py-2">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Service ID</label>
                            <input type="text" id="axRemService" class="w-full border rounded-xl px-3 py-2">
                        </div>
                    </div>
                </div>
                <div class="modal-footer flex justify-end gap-3 p-4 border-t">
                    <button onclick="closeModal('axReminderModal')" class="border px-4 py-2 rounded-xl text-sm">Cancel</button>
                    <button onclick="axSaveReminder()" class="btn-primary text-white px-4 py-2 rounded-xl text-sm">Create Reminder</button>
                </div>
            </div>
        </div>

        <!-- Settings Section -->
        <section id="section-settings" class="p-4 md:p-8 hidden">
            <div class="mb-6">
                <h3 class="text-lg font-semibold text-gray-800">System Settings</h3>
                <p class="text-gray-500 text-sm">Configure system-wide settings and integrations</p>
            </div>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Supabase Configuration -->
                <div class="card p-6">
                    <div class="flex items-start gap-3 mb-4">
                        <div class="w-10 h-10 bg-emerald-100 rounded-xl flex items-center justify-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-emerald-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4" />
                            </svg>
                        </div>
                        <div>
                            <h4 class="font-semibold text-gray-800">Supabase Configuration</h4>
                            <p class="text-sm text-gray-500">Database connection settings</p>
                        </div>
                    </div>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Supabase Project URL</label>
                            <input type="url" id="supabaseUrlSetting" class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-emerald-500/20" placeholder="https://your-project.supabase.co">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Supabase API Key (anon public)</label>
                            <textarea id="supabaseKeySetting" rows="2" class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-emerald-500/20 text-xs" placeholder="Enter your anon key"></textarea>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="saveSupabaseConfig()" class="btn-primary text-white px-4 py-2 rounded-xl text-sm">Save Configuration</button>
                            <button onclick="testSupabaseConnection()" class="border px-4 py-2 rounded-xl text-sm hover:bg-gray-50">Test Connection</button>
                        </div>
                        <div id="supabaseConfigStatus" class="p-3 bg-gray-50 rounded-xl text-sm text-gray-600">
                            <strong>Status:</strong> <span id="supabaseStatusText">Checking...</span>
                        </div>
                    </div>
                </div>

                <!-- Openserve API Integration -->
                <div class="card p-6">
                    <div class="flex items-start justify-between mb-4">
                        <div>
                            <h4 class="font-semibold text-gray-800 flex items-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-emerald-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 9l3 3-3 3m5 0h3M5 20h14a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                                </svg>
                                Openserve API Integration
                            </h4>
                            <p class="text-sm text-gray-500 mt-1">Connect to Openserve for live fibre availability data</p>
                        </div>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="openserveApiToggle" class="sr-only peer" onchange="toggleOpenserveApi(this.checked)">
                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-emerald-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-emerald-600"></div>
                        </label>
                    </div>
                    <div id="openserveApiConfig" class="hidden space-y-4 pt-4 border-t">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">API URL</label>
                            <input type="url" id="openserveApiUrl" class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-emerald-500/20" placeholder="https://api.openserve.co.za">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">API Key</label>
                            <input type="password" id="openserveApiKey" class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-emerald-500/20" placeholder="Enter your API key">
                        </div>
                        <button onclick="saveOpenserveConfig()" class="btn-primary text-white px-4 py-2 rounded-xl text-sm">Save Configuration</button>
                    </div>
                    <div class="mt-4 p-3 bg-amber-50 rounded-xl text-sm text-amber-700" id="openserveApiStatus">
                        <strong>Status:</strong> Inactive - Enable to connect to live Openserve data
                    </div>
                </div>

                <!-- General Settings -->
                <div class="card p-6">
                    <h4 class="font-semibold text-gray-800 mb-4">General Settings</h4>
                    <div class="space-y-4">
                        <div class="flex items-center justify-between py-3 border-b">
                            <div>
                                <p class="font-medium text-gray-700">Auto-approve agents</p>
                                <p class="text-sm text-gray-500">Skip approval for new agents from CSV</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="autoApproveAgents" class="sr-only peer">
                                <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-emerald-600"></div>
                            </label>
                        </div>
                        <div class="flex items-center justify-between py-3 border-b">
                            <div>
                                <p class="font-medium text-gray-700">Email notifications</p>
                                <p class="text-sm text-gray-500">Get notified for new leads and orders</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="emailNotifications" class="sr-only peer" checked>
                                <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-emerald-600"></div>
                            </label>
                        </div>
                        <div class="flex items-center justify-between py-3 border-b">
                            <div>
                                <p class="font-medium text-gray-700">Auto-confirm commissions</p>
                                <p class="text-sm text-gray-500">Auto-confirm after 30 days</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="autoConfirmCommissions" class="sr-only peer">
                                <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-emerald-600"></div>
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- User Privileges Management -->
            <div class="mt-6">
                <div class="card p-6">
                    <div class="flex items-center justify-between mb-6">
                        <div>
                            <h4 class="font-semibold text-gray-800">User Privileges Management</h4>
                            <p class="text-sm text-gray-500">Assign roles and permissions to users</p>
                        </div>
                        <button onclick="openModal('addPrivilegeModal')" class="btn-primary text-white px-4 py-2 rounded-xl text-sm flex items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                            </svg>
                            Add User
                        </button>
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="text-left py-3 px-4 text-xs font-medium text-gray-500 uppercase">User</th>
                                    <th class="text-left py-3 px-4 text-xs font-medium text-gray-500 uppercase">Role</th>
                                    <th class="text-left py-3 px-4 text-xs font-medium text-gray-500 uppercase">Privileges</th>
                                    <th class="text-left py-3 px-4 text-xs font-medium text-gray-500 uppercase">Status</th>
                                    <th class="text-left py-3 px-4 text-xs font-medium text-gray-500 uppercase">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="privilegesTable"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Data Management -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6">
                <div class="card p-6">
                    <h4 class="font-semibold text-gray-800 mb-4">Data Export</h4>
                    <p class="text-sm text-gray-500 mb-4">Export your data for backup or analysis</p>
                    <div class="space-y-3">
                        <button onclick="exportData('leads')" class="w-full flex items-center justify-between p-3 border rounded-xl hover:bg-gray-50">
                            <span class="font-medium text-gray-700">Export All Leads</span>
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                            </svg>
                        </button>
                        <button onclick="exportData('agents')" class="w-full flex items-center justify-between p-3 border rounded-xl hover:bg-gray-50">
                            <span class="font-medium text-gray-700">Export All Agents</span>
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                            </svg>
                        </button>
                        <button onclick="exportData('dealers')" class="w-full flex items-center justify-between p-3 border rounded-xl hover:bg-gray-50">
                            <span class="font-medium text-gray-700">Export All Dealers</span>
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                            </svg>
                        </button>
                        <button onclick="exportData('all')" class="w-full flex items-center justify-between p-3 bg-emerald-50 border border-emerald-200 rounded-xl hover:bg-emerald-100">
                            <span class="font-medium text-emerald-700">Export Complete Backup</span>
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-emerald-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                            </svg>
                        </button>
                    </div>
                </div>

                <div class="card p-6">
                    <h4 class="font-semibold text-gray-800 mb-4">Danger Zone</h4>
                    <p class="text-sm text-gray-500 mb-4">Irreversible and destructive actions</p>
                    <div class="space-y-3">
                        <button onclick="confirmResetStats()" class="w-full flex items-center justify-between p-3 border border-orange-200 bg-orange-50 rounded-xl hover:bg-orange-100">
                            <span class="font-medium text-orange-700">Reset Dashboard Statistics</span>
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-orange-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                            </svg>
                        </button>
                        <button onclick="confirmClearNotifications()" class="w-full flex items-center justify-between p-3 border border-orange-200 bg-orange-50 rounded-xl hover:bg-orange-100">
                            <span class="font-medium text-orange-700">Clear All Notifications</span>
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-orange-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Add Lead Modal -->
    <div id="addLeadModal" class="modal fixed inset-0 bg-black/50 items-center justify-center z-50">
        <div class="bg-white rounded-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto m-4">
            <div class="p-6 border-b flex items-center justify-between">
                <h3 class="text-xl font-semibold">Add New Lead</h3>
                <button onclick="closeModal('addLeadModal')" class="text-gray-400 hover:text-gray-600">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <form id="addLeadForm" class="p-6 space-y-4">
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">First Name *</label>
                        <input type="text" name="first_name" required class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-red-500/20">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Last Name *</label>
                        <input type="text" name="last_name" required class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-red-500/20">
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Email *</label>
                        <input type="email" name="email" required class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-red-500/20">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Phone *</label>
                        <input type="tel" name="phone" required class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-red-500/20">
                    </div>
                </div>
                <div class="grid grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">ID Number</label>
                        <input type="text" name="id_number" id="newLeadIdNumber" maxlength="13" class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-emerald-500/20" placeholder="13-digit SA ID">
                        <p id="newLeadIdError" class="text-red-500 text-xs mt-1 hidden"></p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Passport Number</label>
                        <input type="text" name="passport_number" id="newLeadPassport" class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-emerald-500/20" placeholder="Passport Number">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Address *</label>
                        <input type="text" name="address" required class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-emerald-500/20">
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Package Interest</label>
                        <select name="package_id" class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-red-500/20" id="leadPackageSelect">
                            <option value="">Select Package</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Assign to Agent</label>
                        <select name="agent_id" class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-red-500/20" id="leadAgentSelect">
                            <option value="">Select Agent</option>
                        </select>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Notes</label>
                    <textarea name="notes" rows="3" class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-red-500/20"></textarea>
                </div>
                <div class="flex justify-end gap-3 pt-4">
                    <button type="button" onclick="closeModal('addLeadModal')" class="px-6 py-2 border rounded-xl hover:bg-gray-50">Cancel</button>
                    <button type="submit" class="btn-primary text-white px-6 py-2 rounded-xl">Add Lead</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Openserve Email Import Modal -->
    <div id="openserveEmailModal" class="modal fixed inset-0 bg-black/50 items-center justify-center z-50">
        <div class="bg-white rounded-2xl w-full max-w-3xl max-h-[90vh] overflow-y-auto m-4">
            <div class="p-6 border-b flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-gradient-to-r from-green-500 to-emerald-600 rounded-xl flex items-center justify-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                        </svg>
                    </div>
                    <div>
                        <h3 class="text-xl font-semibold">Import from Openserve Email</h3>
                        <p class="text-sm text-gray-500">Paste the Openserve lead notification email to create a lead</p>
                    </div>
                </div>
                <button onclick="closeModal('openserveEmailModal')" class="text-gray-400 hover:text-gray-600">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <div class="p-6">
                <!-- Step 1: Paste Email -->
                <div id="osEmailStep1">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Paste the Openserve email content below:</label>
                    <textarea id="openserveEmailText" rows="10" class="w-full border rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-green-500/20 text-sm font-mono" placeholder="Heads up, AXXESS AFRICA!

Dear valued partner

The below customer has expressed interest in purchasing your Fibre services, please contact them for further processing.

Lead ID: L10397
Dealer code: ODUN

Customer details:

Full names: Nonopha Vukaphi
Email address: example@gmail.com
Primary contact number: 0788260588
..."></textarea>
                    <div class="flex items-center gap-3 mt-4">
                        <button onclick="parseOpenserveEmail()" class="bg-gradient-to-r from-green-500 to-emerald-600 text-white px-6 py-2 rounded-xl font-medium hover:from-green-600 hover:to-emerald-700 transition-all duration-200 flex items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
                            </svg>
                            Parse Email
                        </button>
                        <button onclick="pasteFromClipboard()" class="border border-gray-300 text-gray-700 px-5 py-2 rounded-xl font-medium hover:bg-gray-50 transition-all duration-200 flex items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
                            </svg>
                            Paste from Clipboard
                        </button>
                    </div>
                </div>

                <!-- Step 2: Review Parsed Data -->
                <div id="osEmailStep2" class="hidden">
                    <div class="bg-green-50 border border-green-200 rounded-xl p-4 mb-4">
                        <div class="flex items-center gap-2 text-green-700 font-medium mb-1">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            Email parsed successfully!
                        </div>
                        <p class="text-sm text-green-600">Review the extracted details below, then click Save to create the lead.</p>
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Lead ID</label>
                            <input type="text" id="osLeadId" readonly class="w-full border rounded-xl px-4 py-2 bg-gray-50 text-gray-600">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Dealer Code</label>
                            <input type="text" id="osDealerCode" readonly class="w-full border rounded-xl px-4 py-2 bg-gray-50 text-gray-600">
                        </div>
                    </div>
                    <div class="mt-4">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
                        <input type="text" id="osFullName" class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-green-500/20">
                    </div>
                    <div class="grid grid-cols-2 gap-4 mt-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                            <input type="email" id="osEmail" class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-green-500/20">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Primary Contact</label>
                            <input type="tel" id="osPrimaryPhone" class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-green-500/20">
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-4 mt-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Alternative Contact</label>
                            <input type="tel" id="osAltPhone" class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-green-500/20">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Preferred Contact Time</label>
                            <input type="text" id="osContactTime" readonly class="w-full border rounded-xl px-4 py-2 bg-gray-50 text-gray-600">
                        </div>
                    </div>
                    <div class="mt-4">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Physical Address</label>
                        <input type="text" id="osAddress" class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-green-500/20">
                    </div>
                    <div class="grid grid-cols-3 gap-4 mt-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Building</label>
                            <input type="text" id="osBuilding" class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-green-500/20">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Floor</label>
                            <input type="text" id="osFloor" class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-green-500/20">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Unit</label>
                            <input type="text" id="osUnit" class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-green-500/20">
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-4 mt-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Assign to Dealer</label>
                            <select id="osDealerSelect" class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-green-500/20">
                                <option value="">Auto-match by dealer code</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Assign to Agent</label>
                            <select id="osAgentSelect" class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-green-500/20">
                                <option value="">Select Agent (optional)</option>
                            </select>
                        </div>
                    </div>

                    <div id="osDealerMatch" class="mt-3 hidden"></div>

                    <div class="flex items-center justify-between mt-6 pt-4 border-t">
                        <button onclick="resetOpenserveEmail()" class="px-5 py-2 border rounded-xl hover:bg-gray-50 text-gray-600 font-medium">
                            Back
                        </button>
                        <div class="flex items-center gap-3">
                            <button type="button" onclick="closeModal('openserveEmailModal')" class="px-5 py-2 border rounded-xl hover:bg-gray-50">Cancel</button>
                            <button onclick="saveOpenserveLead()" class="bg-gradient-to-r from-green-500 to-emerald-600 text-white px-6 py-2 rounded-xl font-medium hover:from-green-600 hover:to-emerald-700 transition-all duration-200 flex items-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                                </svg>
                                Save Lead
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Agent Modal -->
    <div id="addAgentModal" class="modal fixed inset-0 bg-black/50 items-center justify-center z-50">
        <div class="bg-white rounded-2xl w-full max-w-md m-4">
            <div class="p-6 border-b flex items-center justify-between">
                <h3 class="text-xl font-semibold">Add New Agent</h3>
                <button onclick="closeModal('addAgentModal')" class="text-gray-400 hover:text-gray-600">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <form id="addAgentForm" class="p-6 space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Full Name *</label>
                    <input type="text" name="full_name" required class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-red-500/20">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Email *</label>
                    <input type="email" name="email" required class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-red-500/20">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Password *</label>
                    <input type="password" name="password" required minlength="6" class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-red-500/20">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Phone</label>
                    <input type="tel" name="phone" class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-red-500/20">
                </div>
                <div class="flex justify-end gap-3 pt-4">
                    <button type="button" onclick="closeModal('addAgentModal')" class="px-6 py-2 border rounded-xl hover:bg-gray-50">Cancel</button>
                    <button type="submit" class="btn-primary text-white px-6 py-2 rounded-xl">Create Agent</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Agent Modal -->
    <div id="editAgentModal" class="modal fixed inset-0 bg-black/50 items-center justify-center z-50">
        <div class="bg-white rounded-2xl w-full max-w-md m-4">
            <div class="p-6 border-b flex items-center justify-between">
                <h3 class="text-xl font-semibold">Edit Agent</h3>
                <button onclick="closeModal('editAgentModal')" class="text-gray-400 hover:text-gray-600">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <form id="editAgentForm" class="p-6 space-y-4">
                <input type="hidden" name="agent_id" id="editAgentId">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Full Name *</label>
                    <input type="text" name="full_name" id="editAgentName" required class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500/20">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                    <input type="email" name="email" id="editAgentEmail" readonly class="w-full border rounded-xl px-4 py-2 bg-gray-50">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Phone</label>
                    <input type="tel" name="phone" id="editAgentPhone" class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500/20">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Assign to Dealer</label>
                    <select name="dealer_id" id="editAgentDealer" class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500/20">
                        <option value="">No dealer assigned</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Status</label>
                    <select name="is_approved" id="editAgentApproved" class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500/20">
                        <option value="true">Approved</option>
                        <option value="false">Pending</option>
                    </select>
                </div>
                <div class="flex justify-end gap-3 pt-4">
                    <button type="button" onclick="closeModal('editAgentModal')" class="px-6 py-2 border rounded-xl hover:bg-gray-50">Cancel</button>
                    <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-xl">Save Changes</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Dealer Modal -->
    <div id="editDealerModal" class="modal fixed inset-0 bg-black/50 items-center justify-center z-50">
        <div class="bg-white rounded-2xl w-full max-w-lg m-4">
            <div class="p-6 border-b flex items-center justify-between">
                <h3 class="text-xl font-semibold">Edit Dealer</h3>
                <button onclick="closeModal('editDealerModal')" class="text-gray-400 hover:text-gray-600">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <form id="editDealerForm" class="p-6 space-y-4">
                <input type="hidden" name="dealer_id" id="editDealerId">
                <div class="flex items-center gap-4 mb-4">
                    <div id="dealerLogoPreview" class="w-20 h-20 bg-gray-100 rounded-xl flex items-center justify-center text-gray-400 overflow-hidden">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
                        </svg>
                    </div>
                    <div class="flex-1">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Logo URL</label>
                        <input type="url" name="logo_url" id="editDealerLogo" class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500/20" placeholder="https://example.com/logo.png" oninput="previewDealerLogo(this.value)">
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Dealer Name *</label>
                    <input type="text" name="name" id="editDealerName" required class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500/20">
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Dealer Code</label>
                        <input type="text" name="code" id="editDealerCode" class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500/20">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Status</label>
                        <select name="is_active" id="editDealerActive" class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500/20">
                            <option value="true">Active</option>
                            <option value="false">Inactive</option>
                        </select>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Contact Email</label>
                        <input type="email" name="contact_email" id="editDealerEmail" class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500/20">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Contact Phone</label>
                        <input type="tel" name="contact_phone" id="editDealerPhone" class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500/20">
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Assigned Agents</label>
                    <div id="dealerAgentsList" class="bg-gray-50 rounded-xl p-3 max-h-32 overflow-y-auto text-sm text-gray-600">
                        Loading agents...
                    </div>
                </div>
                <div class="border-t pt-4 mt-4">
                    <h4 class="font-medium text-gray-800 mb-3">Dealer Portal Login</h4>
                    <p class="text-xs text-gray-500 mb-3">Set login credentials for the dealer to access the Dealer Portal</p>
                    <div id="dealerLoginStatus" class="mb-3 text-sm"></div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Login Email *</label>
                            <input type="email" name="login_email" id="editDealerLoginEmail" class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500/20" placeholder="dealer@example.com">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                            <input type="password" name="login_password" id="editDealerLoginPassword" class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500/20" placeholder="Leave blank to keep existing">
                        </div>
                    </div>
                </div>
                <div class="flex justify-end gap-3 pt-4">
                    <button type="button" onclick="closeModal('editDealerModal')" class="px-6 py-2 border rounded-xl hover:bg-gray-50">Cancel</button>
                    <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-xl">Save Changes</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Package Modal -->
    <div id="addPackageModal" class="modal fixed inset-0 bg-black/50 items-center justify-center z-50">
        <div class="bg-white rounded-2xl w-full max-w-md m-4">
            <div class="p-6 border-b flex items-center justify-between">
                <h3 class="text-xl font-semibold">Add New Package</h3>
                <button onclick="closeModal('addPackageModal')" class="text-gray-400 hover:text-gray-600">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <form id="addPackageForm" class="p-6 space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Package Name *</label>
                    <input type="text" name="name" required class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-red-500/20" placeholder="e.g., Fibre 50Mbps">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Speed (Mbps) *</label>
                    <input type="number" name="speed" required class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-red-500/20" placeholder="50">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Monthly Price (R) *</label>
                    <input type="number" name="price" required step="0.01" class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-red-500/20" placeholder="699.00">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                    <textarea name="description" rows="3" class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-red-500/20"></textarea>
                </div>
                <div class="flex justify-end gap-3 pt-4">
                    <button type="button" onclick="closeModal('addPackageModal')" class="px-6 py-2 border rounded-xl hover:bg-gray-50">Cancel</button>
                    <button type="submit" class="btn-primary text-white px-6 py-2 rounded-xl">Add Package</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Package Modal -->
    <div id="editPackageModal" class="modal fixed inset-0 bg-black/50 items-center justify-center z-50">
        <div class="bg-white rounded-2xl w-full max-w-md m-4">
            <div class="p-6 border-b flex items-center justify-between">
                <h3 class="text-xl font-semibold">Edit Package</h3>
                <button onclick="closeModal('editPackageModal')" class="text-gray-400 hover:text-gray-600">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <form id="editPackageForm" class="p-6 space-y-4">
                <input type="hidden" id="editPackageId">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Package Name *</label>
                    <input type="text" id="editPackageName" required class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-red-500/20">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Speed (Mbps) *</label>
                    <input type="number" id="editPackageSpeed" required class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-red-500/20">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Monthly Price (R) *</label>
                    <input type="number" id="editPackagePrice" required step="0.01" class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-red-500/20">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Data Cap</label>
                    <input type="text" id="editPackageDataCap" class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-red-500/20" placeholder="Uncapped">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Commission (R)</label>
                    <input type="number" id="editPackageCommission" step="0.01" class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-red-500/20" placeholder="200">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                    <textarea id="editPackageDescription" rows="3" class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-red-500/20"></textarea>
                </div>
                <div class="flex justify-end gap-3 pt-4">
                    <button type="button" onclick="closeModal('editPackageModal')" class="px-6 py-2 border rounded-xl hover:bg-gray-50">Cancel</button>
                    <button type="submit" class="btn-primary text-white px-6 py-2 rounded-xl">Save Changes</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Return to Agent Modal -->
    <div id="returnToAgentModal" class="modal fixed inset-0 bg-black/50 items-center justify-center z-50">
        <div class="bg-white rounded-2xl w-full max-w-md m-4">
            <div class="p-6 border-b flex items-center justify-between">
                <h3 class="text-xl font-semibold">Return to Agent</h3>
                <button onclick="closeModal('returnToAgentModal')" class="text-gray-400 hover:text-gray-600">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <form id="returnToAgentForm" class="p-6 space-y-4">
                <input type="hidden" name="item_id" id="returnItemId">
                <input type="hidden" name="item_type" id="returnItemType">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Reason for Return *</label>
                    <textarea name="return_reason" required rows="3" class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-red-500/20" placeholder="Please provide a reason..."></textarea>
                </div>
                <div class="flex justify-end gap-3 pt-4">
                    <button type="button" onclick="closeModal('returnToAgentModal')" class="px-6 py-2 border rounded-xl hover:bg-gray-50">Cancel</button>
                    <button type="submit" class="btn-primary text-white px-6 py-2 rounded-xl">Return</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Dealer Modal -->
    <div id="addDealerModal" class="modal fixed inset-0 bg-black/50 items-center justify-center z-50">
        <div class="bg-white rounded-2xl w-full max-w-md m-4">
            <div class="p-6 border-b flex items-center justify-between">
                <h3 class="text-xl font-semibold">Add New Dealer</h3>
                <button onclick="closeModal('addDealerModal')" class="text-gray-400 hover:text-gray-600">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <form id="addDealerForm" class="p-6 space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Dealer Name *</label>
                    <input type="text" name="name" required class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-emerald-500/20">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Dealer Code</label>
                    <input type="text" name="code" class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-emerald-500/20" placeholder="e.g., MTL">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Contact Email</label>
                    <input type="email" name="contact_email" class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-emerald-500/20">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Contact Phone</label>
                    <input type="tel" name="contact_phone" class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-emerald-500/20">
                </div>
                <div class="flex justify-end gap-3 pt-4">
                    <button type="button" onclick="closeModal('addDealerModal')" class="px-6 py-2 border rounded-xl hover:bg-gray-50">Cancel</button>
                    <button type="submit" class="btn-primary text-white px-6 py-2 rounded-xl">Add Dealer</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Approve Agent Modal -->
    <div id="approveAgentModal" class="modal fixed inset-0 bg-black/50 items-center justify-center z-50">
        <div class="bg-white rounded-2xl w-full max-w-md m-4">
            <div class="p-6 border-b flex items-center justify-between">
                <h3 class="text-xl font-semibold">Approve Agent</h3>
                <button onclick="closeModal('approveAgentModal')" class="text-gray-400 hover:text-gray-600">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <form id="approveAgentForm" class="p-6 space-y-4">
                <input type="hidden" name="pending_agent_id" id="pendingAgentId">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Full Name *</label>
                    <input type="text" name="full_name" id="approveAgentName" required class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-emerald-500/20">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Email *</label>
                    <input type="email" name="email" id="approveAgentEmail" required readonly class="w-full border rounded-xl px-4 py-2 bg-gray-50">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Password *</label>
                    <input type="password" name="password" required minlength="6" class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-emerald-500/20" placeholder="Set password for agent">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Phone</label>
                    <input type="tel" name="phone" class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-emerald-500/20">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Assign to Dealer</label>
                    <select name="dealer_id" id="approveAgentDealer" class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-emerald-500/20">
                        <option value="">No dealer</option>
                    </select>
                </div>
                <div class="flex justify-end gap-3 pt-4">
                    <button type="button" onclick="closeModal('approveAgentModal')" class="px-6 py-2 border rounded-xl hover:bg-gray-50">Cancel</button>
                    <button type="submit" class="btn-primary text-white px-6 py-2 rounded-xl">Approve & Create</button>
                </div>
            </form>
        </div>
    </div>

    <!-- View Lead Details Modal -->
    <div id="viewLeadModal" class="modal fixed inset-0 bg-black/50 items-center justify-center z-50">
        <div class="bg-white rounded-2xl w-full max-w-2xl m-4 max-h-[90vh] overflow-y-auto">
            <div class="p-6 border-b flex items-center justify-between sticky top-0 bg-white">
                <h3 class="text-xl font-semibold">Lead Details</h3>
                <button onclick="closeModal('viewLeadModal')" class="text-gray-400 hover:text-gray-600">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <div class="p-6" id="viewLeadContent">
                <p class="text-gray-500 text-center">Loading...</p>
            </div>
        </div>
    </div>

    <!-- Convert to Order Modal -->
    <div id="convertToOrderModal" class="modal fixed inset-0 bg-black/50 items-center justify-center z-50">
        <div class="bg-white rounded-2xl w-full max-w-md m-4">
            <div class="p-6 border-b flex items-center justify-between">
                <h3 class="text-xl font-semibold">Convert Lead to Order</h3>
                <button onclick="closeModal('convertToOrderModal')" class="text-gray-400 hover:text-gray-600">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <div class="p-6 space-y-4">
                <div class="bg-blue-50 border border-blue-200 rounded-xl p-4">
                    <p class="text-sm text-blue-800">Converting: <strong id="convertLeadName">-</strong></p>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Order Number *</label>
                    <input type="text" id="convertOrderNumber" required class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-emerald-500/20" placeholder="e.g. ORD-12345">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Product Type *</label>
                    <select id="convertProductType" class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-emerald-500/20">
                        <option value="postpaid">Postpaid (R200 commission)</option>
                        <option value="prepaid">Prepaid (R100 commission)</option>
                    </select>
                </div>
                <div class="bg-gray-50 rounded-xl p-4">
                    <p class="text-sm text-gray-600">Commission will be calculated based on product type:</p>
                    <ul class="text-sm text-gray-500 mt-2 space-y-1">
                        <li> <strong>Postpaid:</strong> R200 per active service</li>
                        <li> <strong>Prepaid:</strong> R100 per active service</li>
                    </ul>
                </div>
                <div class="flex justify-end gap-3 pt-4">
                    <button type="button" onclick="closeModal('convertToOrderModal')" class="px-6 py-2 border rounded-xl hover:bg-gray-50">Cancel</button>
                    <button onclick="convertToOrder()" class="bg-emerald-600 hover:bg-emerald-700 text-white px-6 py-2 rounded-xl font-medium">Convert to Order</button>
                </div>
            </div>
        </div>
    </div>

    <!-- View Order Modal -->
    <div id="viewOrderModal" class="modal fixed inset-0 bg-black/50 items-center justify-center z-50">
        <div class="bg-white rounded-2xl w-full max-w-2xl m-4 max-h-[90vh] overflow-y-auto">
            <div class="p-6 border-b flex items-center justify-between sticky top-0 bg-white">
                <h3 class="text-xl font-semibold">Order Details</h3>
                <button onclick="closeModal('viewOrderModal')" class="text-gray-400 hover:text-gray-600">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <form id="editOrderForm" class="p-6 space-y-4">
                <input type="hidden" id="editOrderLeadId">
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Order Number</label>
                        <input type="text" id="editOrderNumber" class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500/20">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Order Status</label>
                        <select id="editOrderStatus" class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500/20">
                            <option value="pending">Pending</option>
                            <option value="processing">Processing</option>
                            <option value="scheduled">Scheduled</option>
                            <option value="completed">Completed</option>
                            <option value="cancelled">Cancelled</option>
                        </select>
                    </div>
                </div>
                <div class="bg-blue-50 rounded-xl p-4">
                    <h4 class="font-semibold text-gray-700 mb-3">Order Details</h4>
                    <div class="grid grid-cols-3 gap-3">
                        <div>
                            <label class="block text-xs text-gray-500 mb-1">Service ID</label>
                            <input type="text" id="editOrderServiceId" class="w-full border rounded-lg px-3 py-2 text-sm bg-white" readonly>
                        </div>
                        <div>
                            <label class="block text-xs text-gray-500 mb-1">Account Number</label>
                            <input type="text" id="editOrderAccountNumber" class="w-full border rounded-lg px-3 py-2 text-sm bg-white" readonly>
                        </div>
                        <div>
                            <label class="block text-xs text-gray-500 mb-1">Lead ID</label>
                            <input type="text" id="editOrderLeadIdDisplay" class="w-full border rounded-lg px-3 py-2 text-sm bg-white" readonly>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 rounded-xl p-4">
                    <h4 class="font-semibold text-gray-700 mb-3">Client Information</h4>
                    <div class="grid grid-cols-3 gap-3">
                        <div>
                            <label class="block text-xs text-gray-500 mb-1">Full Name</label>
                            <input type="text" id="editOrderClientName" class="w-full border rounded-lg px-3 py-2 text-sm">
                        </div>
                        <div>
                            <label class="block text-xs text-gray-500 mb-1">ID Number</label>
                            <input type="text" id="editOrderIdNumber" maxlength="13" class="w-full border rounded-lg px-3 py-2 text-sm" placeholder="13-digit SA ID">
                            <p id="editOrderIdError" class="text-red-500 text-xs mt-1 hidden"></p>
                        </div>
                        <div>
                            <label class="block text-xs text-gray-500 mb-1">Passport Number</label>
                            <input type="text" id="editOrderPassport" class="w-full border rounded-lg px-3 py-2 text-sm" placeholder="Passport">
                        </div>
                        <div>
                            <label class="block text-xs text-gray-500 mb-1">Email</label>
                            <input type="email" id="editOrderEmail" class="w-full border rounded-lg px-3 py-2 text-sm">
                        </div>
                        <div>
                            <label class="block text-xs text-gray-500 mb-1">Phone</label>
                            <input type="tel" id="editOrderPhone" class="w-full border rounded-lg px-3 py-2 text-sm">
                        </div>
                        <div class="col-span-2">
                            <label class="block text-xs text-gray-500 mb-1">Address</label>
                            <input type="text" id="editOrderAddress" class="w-full border rounded-lg px-3 py-2 text-sm">
                        </div>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Agent</label>
                        <select id="editOrderAgent" class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500/20">
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Dealer</label>
                        <select id="editOrderDealer" class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500/20">
                        </select>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Commission Amount</label>
                        <input type="number" id="editOrderCommission" class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500/20">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Commission Status</label>
                        <select id="editOrderCommissionStatus" class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500/20">
                            <option value="pending">Pending</option>
                            <option value="paid">Paid</option>
                        </select>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Notes</label>
                    <textarea id="editOrderNotes" rows="3" class="w-full border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500/20"></textarea>
                </div>
                <div class="flex justify-end gap-3 pt-4">
                    <button type="button" onclick="closeModal('viewOrderModal')" class="px-6 py-2 border rounded-xl hover:bg-gray-50">Cancel</button>
                    <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-xl">Save Changes</button>
                </div>
            </form>
        </div>
    </div>

    <script src="js/supabase-config.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/admin-dashboard.js"></script>
    <script>document.write('<script src="js/axxess-sales.js?v=' + Date.now() + '"><\/script>');</script>
    <script src="js/admin-dashboard-stats.js"></script>
    <script src="js/preorders.js"></script>
    
    <!-- Debug: Fix Missing Orders -->
    <script>
        async function fixMissingOrders() {
            if (!confirm('This will create order records for converted leads that are missing orders. Continue?')) {
                return;
            }
            
            console.log('Finding converted leads without orders...');
            
            // Get all converted leads
            const { data: leads, error: leadsError } = await window.supabaseClient
                .from('leads')
                .select('*')
                .eq('status', 'converted')
                .order('updated_at', { ascending: false });
            
            if (leadsError) {
                console.error('Error loading leads:', leadsError);
                alert('Error loading leads: ' + leadsError.message);
                return;
            }
            
            console.log(`Found ${leads.length} converted leads`);
            const missingOrders = [];
            
            // Check each lead for corresponding order
            for (const lead of leads) {
                const { data: orders } = await window.supabaseClient
                    .from('orders')
                    .select('id')
                    .eq('lead_id', lead.id);
                
                if (!orders || orders.length === 0) {
                    missingOrders.push(lead);
                }
            }
            
            console.log(`Found ${missingOrders.length} leads without orders`);
            
            if (missingOrders.length === 0) {
                alert('No missing orders found! All converted leads have orders.');
                return;
            }
            
            // Create missing orders
            let created = 0;
            let failed = 0;
            
            for (const lead of missingOrders) {
                try {
                    console.log(`Creating order for ${lead.full_name || lead.first_name + ' ' + lead.last_name}...`);
                    
                    const { error: insertError } = await window.supabaseClient
                        .from('orders')
                        .insert({
                            lead_id: lead.id,
                            package_id: lead.package_id,
                            agent_id: lead.agent_id,
                            dealer_id: lead.dealer_id,
                            order_number: lead.order_number || `ORD-${Date.now()}`,
                            status: lead.order_status || 'pending',
                            notes: `Recovered order - Commission: R${lead.commission_amount || 200}\nService ID: ${lead.service_id || 'N/A'}\nAccount: ${lead.account_number || 'N/A'}\nLead ID: ${lead.lead_id || 'N/A'}\nID Number: ${lead.id_number || 'N/A'}`
                        });
                    
                    if (insertError) {
                        console.error(`Failed to create order:`, insertError);
                        failed++;
                    } else {
                        console.log(` Created order for ${lead.order_number}`);
                        created++;
                    }
                    
                } catch (error) {
                    console.error('Error:', error);
                    failed++;
                }
            }
            
            alert(`Orders Recovery Complete!\n\n Created: ${created}\n Failed: ${failed}\n\nRefresh the page to see the orders.`);
            
            if (created > 0) {
                await loadOrders();
                showSection('orders');
            }
        }
        
        // Add to window for console access
        window.fixMissingOrders = fixMissingOrders;
        
        // Function to update existing orders with missing dealer and lead data
        async function updateIncompleteOrders() {
            if (!confirm('This will update existing orders to include dealer assignments and lead data. Continue?')) {
                return;
            }
            
            console.log('Finding orders with missing dealer or lead data...');
            
            // Get all orders
            const { data: allOrders, error: ordersError } = await window.supabaseClient
                .from('orders')
                .select(`
                    *,
                    lead:leads(*)
                `)
                .order('created_at', { ascending: false });
            
            if (ordersError) {
                console.error('Error loading orders:', ordersError);
                alert('Error loading orders: ' + ordersError.message);
                return;
            }
            
            console.log(`Found ${allOrders.length} total orders`);
            
            // Find orders that need updating (missing dealer or incomplete notes)
            const ordersToUpdate = allOrders.filter(order => {
                const hasLead = order.lead;
                const missingDealer = !order.dealer_id && hasLead && hasLead.dealer_id;
                const incompleteNotes = order.notes && !order.notes.includes('Service ID:');
                return hasLead && (missingDealer || incompleteNotes);
            });
            
            console.log(`Found ${ordersToUpdate.length} orders to update`);
            
            if (ordersToUpdate.length === 0) {
                alert('No incomplete orders found! All orders have complete data.');
                return;
            }
            
            // Update orders
            let updated = 0;
            let failed = 0;
            
            for (const order of ordersToUpdate) {
                try {
                    const lead = order.lead;
                    console.log(`Updating order ${order.order_number}...`);
                    
                    // Clean up notes - remove lead details since they're now in proper fields
                    const baseNotes = order.notes || '';
                    const commissionMatch = baseNotes.match(/Commission: R(\d+)/);
                    const commission = commissionMatch ? commissionMatch[1] : (lead.commission_amount || 200);
                    
                    // Keep only the first line (product type and commission)
                    const cleanNotes = baseNotes.split('\n')[0] || `Order - Commission: R${commission}`;
                    
                    const { error: updateError } = await window.supabaseClient
                        .from('orders')
                        .update({
                            dealer_id: lead.dealer_id || order.dealer_id,
                            notes: cleanNotes
                        })
                        .eq('id', order.id);
                    
                    if (updateError) {
                        console.error(`Failed to update order:`, updateError);
                        failed++;
                    } else {
                        console.log(` Updated order ${order.order_number}`);
                        updated++;
                    }
                    
                } catch (error) {
                    console.error('Error:', error);
                    failed++;
                }
            }
            
            alert(`Orders Update Complete!\n\n Updated: ${updated}\n Failed: ${failed}\n\nRefresh the page to see the changes.`);
            
            if (updated > 0) {
                await loadOrders();
                showSection('orders');
            }
        }
        
        window.updateIncompleteOrders = updateIncompleteOrders;
        console.log(' To fix missing orders, run: fixMissingOrders()');
        console.log(' To update incomplete orders, run: updateIncompleteOrders()');
    </script>
    <script>
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            sidebar.classList.toggle('open');
            overlay.classList.toggle('active');
        }
        
        // Close sidebar when clicking a nav item on mobile
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', () => {
                if (window.innerWidth < 769) {
                    toggleSidebar();
                }
            });
        });
    </script>
</body>
</html>
